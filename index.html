<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Shine - Syst√®me de Gestion Premium</title>
    <style>
        :root {
            --primary-blue: #1e3c72;
            --secondary-blue: #2a5298;
            --gold: #D4AF37;
            --light-gold: #FFD700;
            --dark-blue: #0f2347;
            --light-blue: #f0f4ff;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light-gray: #f8f9fa;
            --border-gray: #e9ecef;
            --dark-gray: #6c757d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .logo {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, var(--gold) 0%, var(--light-gold) 100%);
            border-radius: 50%;
            transform: scale(0.8);
        }

        .logo-text {
            position: relative;
            z-index: 2;
            color: var(--primary-blue);
            font-weight: bold;
            font-size: 1rem;
            text-align: center;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: bold;
            color: var(--light-gold);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            font-style: italic;
        }

        .notification-bar {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .auth-section, .dashboard, .admin-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            border: 3px solid var(--gold);
        }

        .dashboard, .admin-panel {
            padding: 0;
            overflow: hidden;
        }

        .dashboard-header, .admin-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--gold);
        }

        .dashboard-content, .admin-content {
            padding: 30px;
        }

        .role-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .role-btn {
            padding: 15px 30px;
            border: 2px solid var(--gold);
            background: var(--light-blue);
            color: var(--primary-blue);
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .role-btn.active, .role-btn:hover {
            background: var(--gold);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--gold);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--light-gold);
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .money-card {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
        }

        .warning-card {
            background: linear-gradient(135deg, var(--warning) 0%, #fd7e14 100%);
            color: var(--primary-blue);
        }

        .danger-card {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        }

        .info-card {
            background: linear-gradient(135deg, var(--info) 0%, #138496 100%);
        }

        .satisfaction-widget {
            background: linear-gradient(135deg, var(--light-blue) 0%, white 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid var(--gold);
        }

        .satisfaction-stars {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .star {
            font-size: 2rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.3s;
        }

        .star.active, .star:hover {
            color: var(--light-gold);
        }

        .weather-widget {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .upcoming-appointments {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid var(--gold);
        }

        .appointment-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s;
        }

        .appointment-card:hover {
            transform: translateX(5px);
        }

        .loyalty-program {
            background: linear-gradient(135deg, var(--gold) 0%, var(--light-gold) 100%);
            color: var(--primary-blue);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .loyalty-points {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-ring .bg {
            stroke: rgba(255,255,255,0.3);
        }

        .progress-ring .progress {
            stroke: white;
            stroke-dasharray: 377;
            stroke-dashoffset: 377;
            transition: stroke-dashoffset 1s ease;
        }

        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            border: 2px solid var(--gold);
            display: none;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 15px;
            border-radius: 13px 13px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            height: 250px;
            padding: 15px;
            overflow-y: auto;
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid var(--border-gray);
        }

        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 999;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid var(--border-gray);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table h3 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-gray);
        }

        .table th {
            background: var(--light-blue);
            color: var(--primary-blue);
            font-weight: 600;
        }

        .table tr:hover {
            background: var(--light-gray);
        }

        .status-chip {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-confirmed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #cce5ff;
            color: #004085;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .photo-upload {
            border: 2px dashed var(--border-gray);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .photo-upload:hover {
            border-color: var(--gold);
        }

        .photo-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .photo-item {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--border-gray);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rating-summary {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .rating-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .rating-label {
            width: 80px;
            font-weight: 600;
        }

        .rating-progress {
            flex: 1;
            height: 10px;
            background: var(--border-gray);
            border-radius: 5px;
            margin: 0 10px;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            background: var(--gold);
            transition: width 0.3s;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            border: 2px solid;
            position: relative;
        }

        .alert-info {
            background: var(--light-blue);
            color: var(--primary-blue);
            border-color: var(--secondary-blue);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-color: var(--warning);
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: var(--success);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-color: var(--danger);
        }

        .alert .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-blue);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        button {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 60, 114, 0.4);
            border-color: var(--gold);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold) 0%, var(--light-gold) 100%);
            color: var(--primary-blue);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #fd7e14 100%);
            color: var(--primary-blue);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info) 0%, #138496 100%);
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--gold);
            background: var(--light-blue);
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--primary-blue);
        }

        .tab-btn.active {
            background: var(--gold);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .service-section {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid var(--gold);
            border: 2px solid var(--border-gray);
        }

        .service-section h3 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .booking-form, .admin-form {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid var(--border-gray);
        }

        .hidden {
            display: none;
        }

        .error {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .success {
            color: var(--success);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 3px solid var(--gold);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gold);
        }

        .close {
            color: var(--dark-gray);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--danger);
        }

        @media (max-width: 768px) {
            .quick-stats, .services-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }

            .logo-container {
                flex-direction: column;
                text-align: center;
            }

            .logo {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .role-selector {
                flex-direction: column;
            }

            .chat-widget {
                width: 90%;
                right: 5%;
            }

            .appointment-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <div class="logo-text">DR.<br>SHINE</div>
                </div>
                <div>
                    <h1>Dr. Shine</h1>
                    <p>Syst√®me de Gestion Premium</p>
                </div>
            </div>
        </div>

        <!-- Barre de notifications -->
        <div id="notificationBar" class="notification-bar">
            üîÑ Chargement du syst√®me Dr. Shine...
        </div>

        <!-- S√©lection du r√¥le -->
        <div id="roleSelection" class="auth-section">
            <div class="role-selector">
                <button class="role-btn" id="clientRoleBtn" style="font-size: 1.2rem; padding: 20px 40px;">
                    üë§ Espace Client Premium<br>
                    <small style="opacity: 0.8;">G√©rez vos rendez-vous et contrats</small>
                </button>
                <button class="role-btn" id="adminRoleBtn" style="font-size: 1.2rem; padding: 20px 40px;">
                    üîß Administration Avanc√©e<br>
                    <small style="opacity: 0.8;">Gestion compl√®te Dr. Shine</small>
                </button>
            </div>
            
            <div style="text-align: center; margin-top: 20px; color: white;">
                <p><strong>üß™ Comptes de Test :</strong></p>
                <p>üë§ Client : pierre@example.com / DR2025!</p>
                <p>üîß Admin : admin@docshine.net / DrShine2025!</p>
            </div>
        </div>

        <!-- Interface Client Premium -->
        <div id="clientInterface" class="hidden">
            <div id="clientAuth" class="auth-section">
                <h2>üîê Connexion Client</h2>
                <div class="alert alert-info">
                    <strong>Bienvenue chez Dr. Shine !</strong><br>
                    Vos identifiants vous ont √©t√© envoy√©s par email. En cas de probl√®me, contactez-nous au 819-918-5041.
                </div>
                <form id="clientLoginForm">
                    <div class="form-group">
                        <label for="clientEmail">Email :</label>
                        <input type="email" id="clientEmail" required placeholder="votre.email@exemple.com">
                    </div>
                    <div class="form-group">
                        <label for="clientPassword">Mot de passe :</label>
                        <input type="password" id="clientPassword" required>
                    </div>
                    <button type="submit" class="btn-gold">Se connecter</button>
                    <div id="clientLoginError" class="error hidden"></div>
                </form>
            </div>

            <!-- Dashboard Client Premium -->
            <div id="clientDashboard" class="dashboard hidden">
                <div class="dashboard-header">
                    <div>
                        <h2 id="clientWelcome">Bienvenue</h2>
                        <p id="clientInfo"></p>
                    </div>
                    <div>
                        <button id="openChatBtn" class="btn-info" style="margin-right: 10px;">üí¨ Chat</button>
                        <button id="clientLogoutBtn" class="btn-warning">D√©connexion</button>
                    </div>
                </div>

                <div class="dashboard-content">
                    <!-- Widget M√©t√©o -->
                    <div class="weather-widget">
                        <h3>üå§Ô∏è M√©t√©o du Jour</h3>
                        <div id="weatherInfo">
                            <p>Parfait pour nos services ! ‚òÄÔ∏è 22¬∞C</p>
                            <small>Id√©al pour le lavage ext√©rieur</small>
                        </div>
                    </div>

                    <!-- Stats Rapides -->
                    <div class="quick-stats">
                        <div class="stat-card">
                            <div class="number" id="clientPassagesLeft">--</div>
                            <div class="label">Passages Restants</div>
                        </div>
                        <div class="stat-card money-card">
                            <div class="number" id="clientBalanceAmount">--</div>
                            <div class="label">Solde Disponible</div>
                        </div>
                        <div class="stat-card info-card">
                            <div class="number" id="clientSatisfactionScore">--</div>
                            <div class="label">Satisfaction Moyenne</div>
                        </div>
                        <div class="stat-card warning-card">
                            <div class="number" id="clientNextService">--</div>
                            <div class="label">Prochain Service</div>
                        </div>
                    </div>

                    <!-- Programme de Fid√©lit√© -->
                    <div class="loyalty-program">
                        <h3>üèÜ Programme de Fid√©lit√© Dr. Shine</h3>
                        <div class="loyalty-points" id="loyaltyPoints">850</div>
                        <p>Points de fid√©lit√©</p>
                        <div class="progress-ring">
                            <svg>
                                <circle class="bg" cx="60" cy="60" r="50"></circle>
                                <circle class="progress" cx="60" cy="60" r="50" id="loyaltyProgress"></circle>
                            </svg>
                        </div>
                        <p style="margin-top: 10px;">150 points = 1 service gratuit !</p>
                    </div>

                    <!-- Rendez-vous √† venir -->
                    <div class="upcoming-appointments">
                        <h3>üìÖ Vos Prochains Rendez-vous</h3>
                        <div id="clientUpcomingAppts">
                            <!-- G√©n√©r√© dynamiquement -->
                        </div>
                    </div>

                    <!-- Onglets Client -->
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchClientTab('book')">üìÖ R√©server</button>
                        <button class="tab-btn" onclick="switchClientTab('history')">üìä Historique</button>
                        <button class="tab-btn" onclick="switchClientTab('satisfaction')">‚≠ê Satisfaction</button>
                        <button class="tab-btn" onclick="switchClientTab('profile')">üë§ Profil</button>
                    </div>

                    <!-- Onglet R√©servation -->
                    <div id="bookTab" class="tab-content active">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìÖ R√©server un Service</h3>
                                <div class="booking-form">
                                    <form id="clientBookingForm">
                                        <div class="form-group">
                                            <label for="clientService">Service souhait√© :</label>
                                            <select id="clientService" required>
                                                <option value="">S√©lectionnez un service</option>
                                                <option value="menage">üè† Entretien m√©nager</option>
                                                <option value="vitres">ü™ü Lavage de vitres</option>
                                                <option value="auto-ext">üöó Lavage auto ext√©rieur</option>
                                                <option value="auto-int">üöô Lavage auto int√©rieur</option>
                                                <option value="auto-complet">‚ú® Lavage auto complet</option>
                                                <option value="bacs">üóëÔ∏è Lavage bacs √† ordures</option>
                                                <option value="goutieres">üèòÔ∏è Nettoyage goutti√®res</option>
                                                <option value="sinistre">üîß Nettoyage apr√®s sinistre</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="clientDate">Date souhait√©e :</label>
                                            <input type="date" id="clientDate" required>
                                        </div>

                                        <div class="form-group">
                                            <label for="clientTime">Heure pr√©f√©r√©e :</label>
                                            <select id="clientTime" required>
                                                <option value="">S√©lectionnez un cr√©neau</option>
                                                <option value="08:00">08:00 - Matin√©e</option>
                                                <option value="09:00">09:00 - Matin√©e</option>
                                                <option value="10:00">10:00 - Matin√©e</option>
                                                <option value="11:00">11:00 - Fin de matin√©e</option>
                                                <option value="13:00">13:00 - D√©but d'apr√®s-midi</option>
                                                <option value="14:00">14:00 - Apr√®s-midi</option>
                                                <option value="15:00">15:00 - Apr√®s-midi</option>
                                                <option value="16:00">16:00 - Fin d'apr√®s-midi</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label for="urgencyLevel">Niveau d'urgence :</label>
                                            <select id="urgencyLevel">
                                                <option value="normal">Normal</option>
                                                <option value="urgent">Urgent (+15$)</option>
                                                <option value="emergency">Urgence 24h (+35$)</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label for="clientNotes">Instructions sp√©ciales :</label>
                                            <textarea id="clientNotes" rows="3" placeholder="Acc√®s, cl√©s, animaux, allergies, zones prioritaires..."></textarea>
                                        </div>

                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="sendReminder"> 
                                                Recevoir un rappel 24h avant
                                            </label>
                                        </div>

                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="photoService"> 
                                                Demander des photos avant/apr√®s (+5$)
                                            </label>
                                        </div>

                                        <button type="submit" class="btn-success">‚úÖ Confirmer le rendez-vous</button>
                                        <div id="clientBookingError" class="error hidden"></div>
                                        <div id="clientBookingSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìã R√©capitulatif</h3>
                                <div id="clientBookingSummary" class="booking-form">
                                    <p>S√©lectionnez un service et une date pour voir le r√©capitulatif</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Historique -->
                    <div id="historyTab" class="tab-content">
                        <div class="data-table">
                            <h3>üìä Historique D√©taill√© de vos Services</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Note</th>
                                            <th>Co√ªt</th>
                                            <th>Photos</th>
                                        </tr>
                                    </thead>
                                    <tbody id="clientDetailedHistory">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Satisfaction -->
                    <div id="satisfactionTab" class="tab-content">
                        <div class="satisfaction-widget">
                            <h3>‚≠ê √âvaluer votre Dernier Service</h3>
                            <div id="lastServiceToRate">
                                <p>Service du 15/07/2025 - Entretien m√©nager</p>
                                <div class="satisfaction-stars">
                                    <span class="star" onclick="rateLast(1)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(2)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(3)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(4)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(5)">‚≠ê</span>
                                </div>
                                <div class="form-group">
                                    <label for="ratingComment">Commentaire (optionnel) :</label>
                                    <textarea id="ratingComment" rows="3" placeholder="Partagez votre exp√©rience..."></textarea>
                                </div>
                                <button onclick="submitRating()" class="btn-gold">Envoyer l'√©valuation</button>
                                <div id="ratingSuccess" class="success hidden"></div>
                            </div>
                        </div>

                        <div class="rating-summary">
                            <h4>üìà Vos √âvaluations</h4>
                            <div class="rating-bar">
                                <span class="rating-label">5 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 80%;"></div>
                                </div>
                                <span>80%</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">4 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 15%;"></div>
                                </div>
                                <span>15%</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">3 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 5%;"></div>
                                </div>
                                <span>5%</span>
                            </div>
                            <p style="margin-top: 15px;">
                                <strong>Moyenne g√©n√©rale : 4.8/5 ‚≠ê</strong><br>
                                <small>Bas√© sur 12 √©valuations</small>
                            </p>
                        </div>
                    </div>

                    <!-- Onglet Profil -->
                    <div id="profileTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üë§ Informations Personnelles</h3>
                                <div class="booking-form">
                                    <form id="clientProfileForm">
                                        <div class="form-group">
                                            <label for="profileName">Nom complet :</label>
                                            <input type="text" id="profileName">
                                        </div>
                                        <div class="form-group">
                                            <label for="profileEmail">Email :</label>
                                            <input type="email" id="profileEmail">
                                        </div>
                                        <div class="form-group">
                                            <label for="profilePhone">T√©l√©phone :</label>
                                            <input type="tel" id="profilePhone">
                                        </div>
                                        <div class="form-group">
                                            <label for="profileAddress">Adresse :</label>
                                            <textarea id="profileAddress" rows="3"></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="emergencyContact">Contact d'urgence :</label>
                                            <input type="text" id="emergencyContact" placeholder="Nom et t√©l√©phone">
                                        </div>
                                        <button type="submit" class="btn-gold">üíæ Mettre √† jour</button>
                                        <div id="profileSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>‚öôÔ∏è Pr√©f√©rences</h3>
                                <div class="booking-form">
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="emailNotifications" checked> 
                                            Recevoir les notifications par email
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="smsNotifications"> 
                                            Recevoir les rappels par SMS
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferredDay">Jour pr√©f√©r√© :</label>
                                        <select id="preferredDay">
                                            <option value="">Aucune pr√©f√©rence</option>
                                            <option value="monday">Lundi</option>
                                            <option value="tuesday">Mardi</option>
                                            <option value="wednesday">Mercredi</option>
                                            <option value="thursday">Jeudi</option>
                                            <option value="friday">Vendredi</option>
                                            <option value="saturday">Samedi</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferredTime">Heure pr√©f√©r√©e :</label>
                                        <select id="preferredTime">
                                            <option value="">Aucune pr√©f√©rence</option>
                                            <option value="morning">Matin (8h-12h)</option>
                                            <option value="afternoon">Apr√®s-midi (13h-17h)</option>
                                        </select>
                                    </div>
                                    <button onclick="savePreferences()" class="btn-info">‚öôÔ∏è Sauvegarder les pr√©f√©rences</button>
                                    <div id="preferencesSuccess" class="success hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interface Admin Avanc√©e -->
        <div id="adminInterface" class="hidden">
            <div id="adminAuth" class="auth-section">
                <h2>üîê Connexion Administration</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminEmail">Email administrateur :</label>
                        <input type="email" id="adminEmail" required value="admin@docshine.net">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Mot de passe :</label>
                        <input type="password" id="adminPassword" required>
                    </div>
                    <button type="submit" class="btn-gold">Acc√©der √† l'administration</button>
                    <div id="adminLoginError" class="error hidden"></div>
                </form>
            </div>

            <!-- Panel Admin Avanc√© -->
            <div id="adminPanel" class="admin-panel hidden">
                <div class="admin-header">
                    <div>
                        <h2>üîß Administration Dr. Shine Premium</h2>
                        <p>Gestion compl√®te et analytiques avanc√©es</p>
                    </div>
                    <button id="adminLogoutBtn" class="btn-warning">D√©connexion</button>
                </div>

                <div class="admin-content">
                    <!-- Statistiques Rapides Admin -->
                    <div class="quick-stats">
                        <div class="stat-card money-card">
                            <div class="number" id="adminTotalRevenue">--</div>
                            <div class="label">Chiffre d'Affaires</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="adminTotalClients">--</div>
                            <div class="label">Clients Actifs</div>
                        </div>
                        <div class="stat-card info-card">
                            <div class="number" id="adminTodayAppointments">--</div>
                            <div class="label">RDV Aujourd'hui</div>
                        </div>
                        <div class="stat-card warning-card">
                            <div class="number" id="adminAvgSatisfaction">--</div>
                            <div class="label">Satisfaction Moyenne</div>
                        </div>
                        <div class="stat-card danger-card">
                            <div class="number" id="adminLowBalanceClients">--</div>
                            <div class="label">Soldes Faibles</div>
                        </div>
                    </div>

                    <!-- Onglets Admin -->
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchAdminTab('dashboard')">üìä Dashboard</button>
                        <button class="tab-btn" onclick="switchAdminTab('clients')">üë• Clients</button>
                        <button class="tab-btn" onclick="switchAdminTab('appointments')">üìÖ Planning</button>
                        <button class="tab-btn" onclick="switchAdminTab('technicians')">üë∑ Techniciens</button>
                        <button class="tab-btn" onclick="switchAdminTab('analytics')">üìà Analytiques</button>
                        <button class="tab-btn" onclick="switchAdminTab('communications')">üìß Communications</button>
                    </div>

                    <!-- Dashboard Admin -->
                    <div id="dashboardTab" class="tab-content active">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>‚ö° Actions Rapides</h3>
                                <div class="admin-form">
                                    <button onclick="openQuickClientModal()" class="btn-success" style="width: 100%; margin-bottom: 10px;">‚ûï Nouveau Client</button>
                                    <button onclick="sendMassEmail()" class="btn-info" style="width: 100%; margin-bottom: 10px;">üìß Email de Masse</button>
                                    <button onclick="generateReport()" class="btn-warning" style="width: 100%; margin-bottom: 10px;">üìä Rapport Mensuel</button>
                                    <button onclick="backupData()" class="btn-danger" style="width: 100%;">üíæ Sauvegarde</button>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üö® Alertes</h3>
                                <div id="adminAlerts">
                                    <div class="alert alert-warning">
                                        <span class="close-btn" onclick="closeAlert(this)">√ó</span>
                                        <strong>Attention !</strong> 3 clients ont un solde inf√©rieur √† 100$.
                                    </div>
                                    <div class="alert alert-info">
                                        <span class="close-btn" onclick="closeAlert(this)">√ó</span>
                                        <strong>Info :</strong> 5 services programm√©s demain matin.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìÖ Rendez-vous d'Aujourd'hui</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Heure</th>
                                            <th>Client</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="todayAppointmentsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Gestion Clients -->
                    <div id="clientsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>‚ûï Nouveau Client</h3>
                                <div class="admin-form">
                                    <form id="newClientForm">
                                        <div class="form-group">
                                            <label for="newClientName">Nom complet :</label>
                                            <input type="text" id="newClientName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientEmail">Email :</label>
                                            <input type="email" id="newClientEmail" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientPhone">T√©l√©phone :</label>
                                            <input type="tel" id="newClientPhone" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientAddress">Adresse :</label>
                                            <textarea id="newClientAddress" rows="3" required></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="contractAmount">Montant du contrat ($) :</label>
                                            <input type="number" id="contractAmount" step="0.01" required placeholder="4000.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="totalVisits">Nombre de passages inclus :</label>
                                            <input type="number" id="totalVisits" required value="24">
                                        </div>
                                        <div class="form-group">
                                            <label for="initialPayment">Paiement initial re√ßu ($) :</label>
                                            <input type="number" id="initialPayment" step="0.01" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="clientType">Type de client :</label>
                                            <select id="clientType">
                                                <option value="residential">R√©sidentiel</option>
                                                <option value="commercial">Commercial</option>
                                                <option value="premium">Premium</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Cr√©er le client</button>
                                        <div id="newClientSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üîç Recherche Client</h3>
                                <div class="admin-form">
                                    <div class="form-group">
                                        <input type="text" id="clientSearch" placeholder="Rechercher par nom, email ou t√©l√©phone..." onkeyup="searchClients()">
                                    </div>
                                    <div id="searchResults"></div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üë• Liste Compl√®te des Clients</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Contact</th>
                                            <th>Type</th>
                                            <th>Contrat</th>
                                            <th>Passages</th>
                                            <th>Solde</th>
                                            <th>Satisfaction</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fullClientsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Planning -->
                    <div id="appointmentsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìÖ Nouveau Rendez-vous</h3>
                                <div class="admin-form">
                                    <form id="adminBookingForm">
                                        <div class="form-group">
                                            <label for="adminClientSelect">Client :</label>
                                            <select id="adminClientSelect" required>
                                                <option value="">-- Choisir un client --</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminService">Service :</label>
                                            <select id="adminService" required>
                                                <option value="">S√©lectionnez un service</option>
                                                <option value="menage">Entretien m√©nager</option>
                                                <option value="vitres">Lavage de vitres</option>
                                                <option value="auto-ext">Lavage auto ext√©rieur</option>
                                                <option value="auto-int">Lavage auto int√©rieur</option>
                                                <option value="auto-complet">Lavage auto complet</option>
                                                <option value="bacs">Lavage bacs √† ordures</option>
                                                <option value="goutieres">Nettoyage goutti√®res</option>
                                                <option value="sinistre">Nettoyage apr√®s sinistre</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminDate">Date :</label>
                                            <input type="date" id="adminDate" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminTime">Heure :</label>
                                            <input type="time" id="adminTime" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="assignedTechnician">Technicien assign√© :</label>
                                            <select id="assignedTechnician">
                                                <option value="">√Ä assigner</option>
                                                <option value="tech1">Jean-Marc L.</option>
                                                <option value="tech2">Sophie D.</option>
                                                <option value="tech3">Michel R.</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminNotes">Notes :</label>
                                            <textarea id="adminNotes" rows="3"></textarea>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Cr√©er le RDV</button>
                                        <div id="adminBookingSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìä Vue d'ensemble</h3>
                                <div class="admin-form">
                                    <div style="text-align: center;">
                                        <h4 id="planningDate">Aujourd'hui</h4>
                                        <div class="quick-stats" style="margin: 15px 0;">
                                            <div class="stat-card" style="margin: 5px;">
                                                <div class="number" id="todayTotal">--</div>
                                                <div class="label">Total RDV</div>
                                            </div>
                                            <div class="stat-card success-card" style="margin: 5px;">
                                                <div class="number" id="todayCompleted">--</div>
                                                <div class="label">Termin√©s</div>
                                            </div>
                                        </div>
                                        <button onclick="openCalendarView()" class="btn-info">üìÖ Vue Calendrier</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìÖ Tous les Rendez-vous</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Heure</th>
                                            <th>Client</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allAppointmentsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Gestion Techniciens -->
                    <div id="techniciansTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üë∑ Nouveau Technicien</h3>
                                <div class="admin-form">
                                    <form id="newTechnicianForm">
                                        <div class="form-group">
                                            <label for="techName">Nom complet :</label>
                                            <input type="text" id="techName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techEmail">Email :</label>
                                            <input type="email" id="techEmail" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techPhone">T√©l√©phone :</label>
                                            <input type="tel" id="techPhone" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techSpecialty">Sp√©cialit√© :</label>
                                            <select id="techSpecialty">
                                                <option value="all">Tous services</option>
                                                <option value="residential">R√©sidentiel</option>
                                                <option value="commercial">Commercial</option>
                                                <option value="auto">Automobile</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Ajouter</button>
                                        <div id="newTechSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìä Performance</h3>
                                <div class="admin-form">
                                    <div class="rating-summary">
                                        <h4>üèÜ Top Technicien du Mois</h4>
                                        <p><strong>Jean-Marc L.</strong></p>
                                        <p>‚≠ê 4.9/5 - 45 services</p>
                                        <p>üí∞ 3,200$ de revenus</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üë∑ √âquipe Dr. Shine</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Contact</th>
                                            <th>Sp√©cialit√©</th>
                                            <th>Services/Mois</th>
                                            <th>Note Moyenne</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="techniciansTable">
                                        <tr>
                                            <td>Jean-Marc L.</td>
                                            <td>jm.laurent@docshine.net<br>819-555-0100</td>
                                            <td>Tous services</td>
                                            <td>45</td>
                                            <td>‚≠ê 4.9</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Sophie D.</td>
                                            <td>s.dubois@docshine.net<br>819-555-0101</td>
                                            <td>R√©sidentiel</td>
                                            <td>38</td>
                                            <td>‚≠ê 4.8</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Michel R.</td>
                                            <td>m.roy@docshine.net<br>819-555-0102</td>
                                            <td>Commercial</td>
                                            <td>52</td>
                                            <td>‚≠ê 4.7</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Analytiques -->
                    <div id="analyticsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìà Revenus Mensuels</h3>
                                <div class="admin-form">
                                    <canvas id="revenueChart" width="400" height="200"></canvas>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üèÜ Services Populaires</h3>
                                <div class="admin-form">
                                    <div class="rating-bar">
                                        <span class="rating-label">M√©nage</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 45%;"></div>
                                        </div>
                                        <span>45%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Vitres</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 25%;"></div>
                                        </div>
                                        <span>25%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Auto</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 20%;"></div>
                                        </div>
                                        <span>20%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Autres</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 10%;"></div>
                                        </div>
                                        <span>10%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìä Rapport D√©taill√©</h3>
                            <div class="rating-summary">
                                <h4>üìà M√©triques Cl√©s</h4>
                                <div class="quick-stats">
                                    <div class="stat-card money-card">
                                        <div class="number">15,850$</div>
                                        <div class="label">Revenus ce mois</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="number">142</div>
                                        <div class="label">Services effectu√©s</div>
                                    </div>
                                    <div class="stat-card info-card">
                                        <div class="number">4.8‚≠ê</div>
                                        <div class="label">Satisfaction moyenne</div>
                                    </div>
                                    <div class="stat-card success-card">
                                        <div class="number">96%</div>
                                        <div class="label">Taux de fid√©lisation</div>
                                    </div>
                                </div>
                                
                                <h4 style="margin-top: 20px;">üéØ Objectifs</h4>
                                <div class="rating-bar">
                                    <span class="rating-label">Revenus (18k$)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 88%;"></div>
                                    </div>
                                    <span>88%</span>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-label">Clients (160)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 75%;"></div>
                                    </div>
                                    <span>75%</span>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-label">Satisfaction (4.9)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 98%;"></div>
                                    </div>
                                    <span>98%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communications -->
                    <div id="communicationsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìß Email de Masse</h3>
                                <div class="admin-form">
                                    <form id="massEmailForm">
                                        <div class="form-group">
                                            <label for="emailTarget">Destinataires :</label>
                                            <select id="emailTarget">
                                                <option value="all">Tous les clients</option>
                                                <option value="residential">Clients r√©sidentiels</option>
                                                <option value="commercial">Clients commerciaux</option>
                                                <option value="low_balance">Soldes faibles</option>
                                                <option value="inactive">Clients inactifs</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="massSubject">Objet :</label>
                                            <input type="text" id="massSubject" placeholder="Objet de l'email">
                                        </div>
                                        <div class="form-group">
                                            <label for="massMessage">Message :</label>
                                            <textarea id="massMessage" rows="6" placeholder="Votre message..."></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="includePromo"> 
                                                Inclure une promotion (10% de r√©duction)
                                            </label>
                                        </div>
                                        <button type="submit" class="btn-warning">üìß Envoyer √† <span id="targetCount">--</span> clients</button>
                                        <div id="massEmailSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üì± Notifications Push</h3>
                                <div class="admin-form">
                                    <div class="form-group">
                                        <label for="pushMessage">Message de notification :</label>
                                        <textarea id="pushMessage" rows="3" placeholder="Message court pour notification..."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="pushType">Type :</label>
                                        <select id="pushType">
                                            <option value="info">Information</option>
                                            <option value="promo">Promotion</option>
                                            <option value="reminder">Rappel</option>
                                            <option value="urgent">Urgent</option>
                                        </select>
                                    </div>
                                    <button onclick="sendPushNotification()" class="btn-info">üì± Envoyer</button>
                                    <div id="pushSuccess" class="success hidden"></div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìú Historique des Communications</h3>
                            <div id="communicationsHistory">
                                <div class="appointment-card">
                                    <div>
                                        <strong>Email de masse</strong> - Promotion √©t√© 2025<br>
                                        <small>Envoy√© √† 45 clients - 13/07/2025 14:30</small>
                                    </div>
                                    <span class="status-chip status-completed">Envoy√©</span>
                                </div>
                                <div class="appointment-card">
                                    <div>
                                        <strong>Rappel RDV</strong> - Pierre Tremblay<br>
                                        <small>SMS automatique - 12/07/2025 18:00</small>
                                    </div>
                                    <span class="status-chip status-completed">Livr√©</span>
                                </div>
                                <div class="appointment-card">
                                    <div>
                                        <strong>Email d'identifiants</strong> - Marie Dubois<br>
                                        <small>Nouveau client - 10/07/2025 10:15</small>
                                    </div>
                                    <span class="status-chip status-completed">Lu</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget Chat -->
        <button class="chat-toggle" id="chatToggleBtn">üí¨</button>
        <div id="chatWidget" class="chat-widget">
            <div class="chat-header">
                <span>üí¨ Support Dr. Shine</span>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 1.2rem;">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div style="padding: 10px; background: #f0f4ff; border-radius: 10px; margin-bottom: 10px;">
                    <strong>Dr. Shine Bot :</strong><br>
                    Bonjour ! Comment puis-je vous aider aujourd'hui ? üòä
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Tapez votre message..." onkeypress="handleChatEnter(event)">
                <button onclick="sendChatMessage()" class="btn-gold" style="margin-top: 10px; width: 100%;">Envoyer</button>
            </div>
        </div>

        <!-- Modals -->
        <div id="quickClientModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚ûï Nouveau Client Rapide</h3>
                    <span class="close" onclick="closeModal('quickClientModal')">&times;</span>
                </div>
                <form id="quickClientForm">
                    <div class="form-group">
                        <label for="quickName">Nom :</label>
                        <input type="text" id="quickName" required>
                    </div>
                    <div class="form-group">
                        <label for="quickEmail">Email :</label>
                        <input type="email" id="quickEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="quickPhone">T√©l√©phone :</label>
                        <input type="tel" id="quickPhone" required>
                    </div>
                    <button type="submit" class="btn-success">Cr√©er</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Base de donn√©es √©tendue
        let users = [
            {
                id: 1,
                name: "Pierre Tremblay",
                email: "pierre@example.com",
                phone: "819-555-0123",
                address: "123 Rue Principale, Gatineau, QC",
                password: "DR2025!",
                contractAmount: 4000,
                totalVisits: 24,
                usedVisits: 8,
                prepaidBalance: 2666.67,
                extraCredits: 2,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "residential",
                loyaltyPoints: 850,
                avgRating: 4.8,
                emergencyContact: "Marie Tremblay - 819-555-0124",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: false,
                    preferredDay: "tuesday",
                    preferredTime: "morning"
                }
            },
            {
                id: 2,
                name: "Marie Dubois",
                email: "marie@example.com",
                phone: "819-555-0456", 
                address: "456 Avenue des √ârables, Ottawa, ON",
                password: "DR2025!",
                contractAmount: 6000,
                totalVisits: 24,
                usedVisits: 15,
                prepaidBalance: 2250,
                extraCredits: 0,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "premium",
                loyaltyPoints: 1200,
                avgRating: 4.9,
                emergencyContact: "Paul Dubois - 819-555-0457",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: true,
                    preferredDay: "friday",
                    preferredTime: "afternoon"
                }
            },
            {
                id: 3,
                name: "Restaurant Le Gourmet",
                email: "contact@legourmet.ca",
                phone: "819-555-0789",
                address: "789 Boulevard Commercial, Gatineau, QC",
                password: "DR2025!",
                contractAmount: 8000,
                totalVisits: 24,
                usedVisits: 12,
                prepaidBalance: 2666.67,
                extraCredits: 0,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "commercial",
                loyaltyPoints: 400,
                avgRating: 4.7,
                emergencyContact: "Manager - 819-555-0790",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: false,
                    preferredDay: "monday",
                    preferredTime: "morning"
                }
            }
        ];

        let appointments = [
            {
                id: 1,
                userId: 1,
                date: "2025-07-20",
                time: "09:00",
                service: "menage",
                status: "confirmed",
                cost: 166.67,
                notes: "Attention aux plantes",
                createdAt: "2025-07-10",
                technician: "Jean-Marc L.",
                urgency: "normal",
                photoService: false,
                rating: null,
                ratingComment: ""
            },
            {
                id: 2,
                userId: 1,
                date: "2025-07-05",
                time: "14:00",
                service: "vitres",
                status: "completed",
                cost: 166.67,
                notes: "",
                createdAt: "2025-06-25",
                technician: "Sophie D.",
                urgency: "normal",
                photoService: true,
                rating: 5,
                ratingComment: "Excellent travail, tr√®s satisfait!"
            },
            {
                id: 3,
                userId: 2,
                date: "2025-07-18",
                time: "10:00",
                service: "auto-complet",
                status: "pending",
                cost: 250.00,
                notes: "V√©hicule dans l'entr√©e",
                createdAt: "2025-07-11",
                technician: "Michel R.",
                urgency: "normal",
                photoService: false,
                rating: null,
                ratingComment: ""
            },
            {
                id: 4,
                userId: 3,
                date: "2025-07-15",
                time: "07:00",
                service: "menage",
                status: "completed",
                cost: 333.33,
                notes: "Nettoyage cuisine commercial",
                createdAt: "2025-07-08",
                technician: "Jean-Marc L.",
                urgency: "normal",
                photoService: true,
                rating: 4,
                ratingComment: "Bon service"
            }
        ];

        let technicians = [
            {
                id: 1,
                name: "Jean-Marc L.",
                email: "jm.laurent@docshine.net",
                phone: "819-555-0100",
                specialty: "all",
                monthlyServices: 45,
                avgRating: 4.9,
                status: "active"
            },
            {
                id: 2,
                name: "Sophie D.",
                email: "s.dubois@docshine.net",
                phone: "819-555-0101",
                specialty: "residential",
                monthlyServices: 38,
                avgRating: 4.8,
                status: "active"
            },
            {
                id: 3,
                name: "Michel R.",
                email: "m.roy@docshine.net",
                phone: "819-555-0102",
                specialty: "commercial",
                monthlyServices: 52,
                avgRating: 4.7,
                status: "active"
            }
        ];

        let communications = [];
        let currentUser = null;
        let currentRole = null;
        let lastRating = 0;

        const adminCredentials = {
            email: "admin@docshine.net",
            password: "DrShine2025!"
        };

        const serviceNames = {
            'menage': 'Entretien m√©nager',
            'vitres': 'Lavage de vitres', 
            'auto-ext': 'Lavage auto ext√©rieur',
            'auto-int': 'Lavage auto int√©rieur',
            'auto-complet': 'Lavage auto complet',
            'bacs': 'Lavage bacs √† ordures',
            'goutieres': 'Nettoyage goutti√®res',
            'sinistre': 'Nettoyage apr√®s sinistre'
        };

        // Fonctions utilitaires
        function calculateCostPerVisit(user) {
            return user.contractAmount / user.totalVisits;
        }

        function generatePassword() {
            return "DR" + new Date().getFullYear() + "!";
        }

        function getCurrentURL() {
            return window.location.href;
        }

        function showNotification(message, type = 'info') {
            const bar = document.getElementById('notificationBar');
            bar.textContent = message;
            bar.className = `notification-bar`;
            bar.classList.remove('hidden');
            
            setTimeout(() => {
                bar.classList.add('hidden');
            }, 5000);
        }

        // Gestion des r√¥les - FONCTION CORRIG√âE
        function selectRole(role) {
            console.log('Role s√©lectionn√©:', role);
            
            // R√©initialiser l'√©tat des boutons
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            
            // Activer le bouton cliqu√©
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Masquer la s√©lection de r√¥le
            const roleSelection = document.getElementById('roleSelection');
            if (roleSelection) {
                roleSelection.classList.add('hidden');
            }
            
            // Afficher l'interface appropri√©e
            if (role === 'client') {
                currentRole = 'client';
                const clientInterface = document.getElementById('clientInterface');
                if (clientInterface) {
                    clientInterface.classList.remove('hidden');
                }
                showNotification('Interface client charg√©e!');
            } else if (role === 'admin') {
                currentRole = 'admin';
                const adminInterface = document.getElementById('adminInterface');
                if (adminInterface) {
                    adminInterface.classList.remove('hidden');
                }
                showNotification('Interface admin charg√©e!');
            }
        }

        // Connexion client - CORRIG√âE
        document.getElementById('clientLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Tentative de connexion client...');
            
            const email = document.getElementById('clientEmail').value;
            const password = document.getElementById('clientPassword').value;

            console.log('Email:', email, 'Password:', password);

            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                console.log('Utilisateur trouv√©:', user);
                currentUser = user;
                showClientDashboard();
                showNotification(`Bienvenue ${user.name} ! üéâ`);
            } else {
                console.log('Utilisateur non trouv√©');
                showError('clientLoginError', 'Email ou mot de passe incorrect');
            }
        });

        // Connexion admin - CORRIG√âE
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Tentative de connexion admin...');
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            console.log('Admin Email:', email, 'Password:', password);

            if (email === adminCredentials.email && password === adminCredentials.password) {
                console.log('Admin connect√©');
                showAdminPanel();
                showNotification('Acc√®s administrateur autoris√© üîê');
            } else {
                console.log('√âchec connexion admin');
                showError('adminLoginError', 'Identifiants administrateur incorrects');
            }
        });

        function showClientDashboard() {
            console.log('Affichage dashboard client...');
            
            const clientAuth = document.getElementById('clientAuth');
            const clientDashboard = document.getElementById('clientDashboard');
            
            if (clientAuth && clientDashboard) {
                clientAuth.classList.add('hidden');
                clientDashboard.classList.remove('hidden');
                
                updateClientDashboard();
                updateClientBookingDate();
                updateLoyaltyProgram();
                loadClientUpcomingAppointments();
                
                console.log('Dashboard client affich√© avec succ√®s');
            } else {
                console.error('√âl√©ments dashboard client non trouv√©s');
            }
        }

        function showAdminPanel() {
            console.log('Affichage panel admin...');
            
            const adminAuth = document.getElementById('adminAuth');
            const adminPanel = document.getElementById('adminPanel');
            
            if (adminAuth && adminPanel) {
                adminAuth.classList.add('hidden');
                adminPanel.classList.remove('hidden');
                
                updateAdminInterface();
                
                console.log('Panel admin affich√© avec succ√®s');
            } else {
                console.error('√âl√©ments panel admin non trouv√©s');
            }
        }

        function updateClientDashboard() {
            console.log('Mise √† jour dashboard client...');
            
            try {
                const welcomeElement = document.getElementById('clientWelcome');
                const infoElement = document.getElementById('clientInfo');
                
                if (welcomeElement && infoElement && currentUser) {
                    welcomeElement.textContent = `Bienvenue, ${currentUser.name}`;
                    infoElement.textContent = `Contrat ${currentUser.clientType}: ${currentUser.contractAmount}$ (${currentUser.totalVisits} passages)`;
                    
                    const costPerVisit = calculateCostPerVisit(currentUser);
                    const remaining = currentUser.totalVisits - currentUser.usedVisits;
                    
                    // Stats rapides
                    const passagesLeftElement = document.getElementById('clientPassagesLeft');
                    const balanceElement = document.getElementById('clientBalanceAmount');
                    const satisfactionElement = document.getElementById('clientSatisfactionScore');
                    
                    if (passagesLeftElement) passagesLeftElement.textContent = remaining;
                    if (balanceElement) balanceElement.textContent = `${currentUser.prepaidBalance.toFixed(0)}<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Shine - Syst√®me de Gestion Premium</title>
    <style>
        :root {
            --primary-blue: #1e3c72;
            --secondary-blue: #2a5298;
            --gold: #D4AF37;
            --light-gold: #FFD700;
            --dark-blue: #0f2347;
            --light-blue: #f0f4ff;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light-gray: #f8f9fa;
            --border-gray: #e9ecef;
            --dark-gray: #6c757d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .logo {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, var(--gold) 0%, var(--light-gold) 100%);
            border-radius: 50%;
            transform: scale(0.8);
        }

        .logo-text {
            position: relative;
            z-index: 2;
            color: var(--primary-blue);
            font-weight: bold;
            font-size: 1rem;
            text-align: center;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: bold;
            color: var(--light-gold);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            font-style: italic;
        }

        .notification-bar {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .auth-section, .dashboard, .admin-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            border: 3px solid var(--gold);
        }

        .dashboard, .admin-panel {
            padding: 0;
            overflow: hidden;
        }

        .dashboard-header, .admin-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--gold);
        }

        .dashboard-content, .admin-content {
            padding: 30px;
        }

        .role-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .role-btn {
            padding: 15px 30px;
            border: 2px solid var(--gold);
            background: var(--light-blue);
            color: var(--primary-blue);
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .role-btn.active, .role-btn:hover {
            background: var(--gold);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--gold);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--light-gold);
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .money-card {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
        }

        .warning-card {
            background: linear-gradient(135deg, var(--warning) 0%, #fd7e14 100%);
            color: var(--primary-blue);
        }

        .danger-card {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        }

        .info-card {
            background: linear-gradient(135deg, var(--info) 0%, #138496 100%);
        }

        .satisfaction-widget {
            background: linear-gradient(135deg, var(--light-blue) 0%, white 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid var(--gold);
        }

        .satisfaction-stars {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .star {
            font-size: 2rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.3s;
        }

        .star.active, .star:hover {
            color: var(--light-gold);
        }

        .weather-widget {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .upcoming-appointments {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid var(--gold);
        }

        .appointment-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s;
        }

        .appointment-card:hover {
            transform: translateX(5px);
        }

        .loyalty-program {
            background: linear-gradient(135deg, var(--gold) 0%, var(--light-gold) 100%);
            color: var(--primary-blue);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .loyalty-points {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-ring .bg {
            stroke: rgba(255,255,255,0.3);
        }

        .progress-ring .progress {
            stroke: white;
            stroke-dasharray: 377;
            stroke-dashoffset: 377;
            transition: stroke-dashoffset 1s ease;
        }

        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            border: 2px solid var(--gold);
            display: none;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 15px;
            border-radius: 13px 13px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            height: 250px;
            padding: 15px;
            overflow-y: auto;
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid var(--border-gray);
        }

        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 999;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid var(--border-gray);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table h3 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-gray);
        }

        .table th {
            background: var(--light-blue);
            color: var(--primary-blue);
            font-weight: 600;
        }

        .table tr:hover {
            background: var(--light-gray);
        }

        .status-chip {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-confirmed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #cce5ff;
            color: #004085;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .photo-upload {
            border: 2px dashed var(--border-gray);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .photo-upload:hover {
            border-color: var(--gold);
        }

        .photo-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .photo-item {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--border-gray);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rating-summary {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .rating-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .rating-label {
            width: 80px;
            font-weight: 600;
        }

        .rating-progress {
            flex: 1;
            height: 10px;
            background: var(--border-gray);
            border-radius: 5px;
            margin: 0 10px;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            background: var(--gold);
            transition: width 0.3s;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            border: 2px solid;
            position: relative;
        }

        .alert-info {
            background: var(--light-blue);
            color: var(--primary-blue);
            border-color: var(--secondary-blue);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-color: var(--warning);
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: var(--success);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-color: var(--danger);
        }

        .alert .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-blue);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        button {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 60, 114, 0.4);
            border-color: var(--gold);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold) 0%, var(--light-gold) 100%);
            color: var(--primary-blue);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #fd7e14 100%);
            color: var(--primary-blue);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info) 0%, #138496 100%);
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--gold);
            background: var(--light-blue);
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--primary-blue);
        }

        .tab-btn.active {
            background: var(--gold);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .service-section {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid var(--gold);
            border: 2px solid var(--border-gray);
        }

        .service-section h3 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .booking-form, .admin-form {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid var(--border-gray);
        }

        .hidden {
            display: none;
        }

        .error {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .success {
            color: var(--success);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 3px solid var(--gold);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gold);
        }

        .close {
            color: var(--dark-gray);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--danger);
        }

        @media (max-width: 768px) {
            .quick-stats, .services-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }

            .logo-container {
                flex-direction: column;
                text-align: center;
            }

            .logo {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .role-selector {
                flex-direction: column;
            }

            .chat-widget {
                width: 90%;
                right: 5%;
            }

            .appointment-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <div class="logo-text">DR.<br>SHINE</div>
                </div>
                <div>
                    <h1>Dr. Shine</h1>
                    <p>Syst√®me de Gestion Premium</p>
                </div>
            </div>
        </div>

        <!-- Barre de notifications -->
        <div id="notificationBar" class="notification-bar hidden">
            üì¢ Nouveau message ou alerte importante !
        </div>

        <!-- S√©lection du r√¥le -->
        <div id="roleSelection" class="auth-section">
            <div class="role-selector">
                <button class="role-btn" onclick="selectRole('client')">
                    üë§ Espace Client Premium
                </button>
                <button class="role-btn" onclick="selectRole('admin')">
                    üîß Administration Avanc√©e
                </button>
            </div>
        </div>

        <!-- Interface Client Premium -->
        <div id="clientInterface" class="hidden">
            <div id="clientAuth" class="auth-section">
                <h2>üîê Connexion Client</h2>
                <div class="alert alert-info">
                    <strong>Bienvenue chez Dr. Shine !</strong><br>
                    Vos identifiants vous ont √©t√© envoy√©s par email. En cas de probl√®me, contactez-nous au 819-918-5041.
                </div>
                <form id="clientLoginForm">
                    <div class="form-group">
                        <label for="clientEmail">Email :</label>
                        <input type="email" id="clientEmail" required placeholder="votre.email@exemple.com">
                    </div>
                    <div class="form-group">
                        <label for="clientPassword">Mot de passe :</label>
                        <input type="password" id="clientPassword" required>
                    </div>
                    <button type="submit" class="btn-gold">Se connecter</button>
                    <div id="clientLoginError" class="error hidden"></div>
                </form>
            </div>

            <!-- Dashboard Client Premium -->
            <div id="clientDashboard" class="dashboard hidden">
                <div class="dashboard-header">
                    <div>
                        <h2 id="clientWelcome">Bienvenue</h2>
                        <p id="clientInfo"></p>
                    </div>
                    <div>
                        <button onclick="openChat()" class="btn-info" style="margin-right: 10px;">üí¨ Chat</button>
                        <button onclick="logout()" class="btn-warning">D√©connexion</button>
                    </div>
                </div>

                <div class="dashboard-content">
                    <!-- Widget M√©t√©o -->
                    <div class="weather-widget">
                        <h3>üå§Ô∏è M√©t√©o du Jour</h3>
                        <div id="weatherInfo">
                            <p>Parfait pour nos services ! ‚òÄÔ∏è 22¬∞C</p>
                            <small>Id√©al pour le lavage ext√©rieur</small>
                        </div>
                    </div>

                    <!-- Stats Rapides -->
                    <div class="quick-stats">
                        <div class="stat-card">
                            <div class="number" id="clientPassagesLeft">--</div>
                            <div class="label">Passages Restants</div>
                        </div>
                        <div class="stat-card money-card">
                            <div class="number" id="clientBalanceAmount">--</div>
                            <div class="label">Solde Disponible</div>
                        </div>
                        <div class="stat-card info-card">
                            <div class="number" id="clientSatisfactionScore">--</div>
                            <div class="label">Satisfaction Moyenne</div>
                        </div>
                        <div class="stat-card warning-card">
                            <div class="number" id="clientNextService">--</div>
                            <div class="label">Prochain Service</div>
                        </div>
                    </div>

                    <!-- Programme de Fid√©lit√© -->
                    <div class="loyalty-program">
                        <h3>üèÜ Programme de Fid√©lit√© Dr. Shine</h3>
                        <div class="loyalty-points" id="loyaltyPoints">850</div>
                        <p>Points de fid√©lit√©</p>
                        <div class="progress-ring">
                            <svg>
                                <circle class="bg" cx="60" cy="60" r="50"></circle>
                                <circle class="progress" cx="60" cy="60" r="50" id="loyaltyProgress"></circle>
                            </svg>
                        </div>
                        <p style="margin-top: 10px;">150 points = 1 service gratuit !</p>
                    </div>

                    <!-- Rendez-vous √† venir -->
                    <div class="upcoming-appointments">
                        <h3>üìÖ Vos Prochains Rendez-vous</h3>
                        <div id="clientUpcomingAppts">
                            <!-- G√©n√©r√© dynamiquement -->
                        </div>
                    </div>

                    <!-- Onglets Client -->
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchClientTab('book')">üìÖ R√©server</button>
                        <button class="tab-btn" onclick="switchClientTab('history')">üìä Historique</button>
                        <button class="tab-btn" onclick="switchClientTab('satisfaction')">‚≠ê Satisfaction</button>
                        <button class="tab-btn" onclick="switchClientTab('profile')">üë§ Profil</button>
                    </div>

                    <!-- Onglet R√©servation -->
                    <div id="bookTab" class="tab-content active">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìÖ R√©server un Service</h3>
                                <div class="booking-form">
                                    <form id="clientBookingForm">
                                        <div class="form-group">
                                            <label for="clientService">Service souhait√© :</label>
                                            <select id="clientService" required>
                                                <option value="">S√©lectionnez un service</option>
                                                <option value="menage">üè† Entretien m√©nager</option>
                                                <option value="vitres">ü™ü Lavage de vitres</option>
                                                <option value="auto-ext">üöó Lavage auto ext√©rieur</option>
                                                <option value="auto-int">üöô Lavage auto int√©rieur</option>
                                                <option value="auto-complet">‚ú® Lavage auto complet</option>
                                                <option value="bacs">üóëÔ∏è Lavage bacs √† ordures</option>
                                                <option value="goutieres">üèòÔ∏è Nettoyage goutti√®res</option>
                                                <option value="sinistre">üîß Nettoyage apr√®s sinistre</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="clientDate">Date souhait√©e :</label>
                                            <input type="date" id="clientDate" required>
                                        </div>

                                        <div class="form-group">
                                            <label for="clientTime">Heure pr√©f√©r√©e :</label>
                                            <select id="clientTime" required>
                                                <option value="">S√©lectionnez un cr√©neau</option>
                                                <option value="08:00">08:00 - Matin√©e</option>
                                                <option value="09:00">09:00 - Matin√©e</option>
                                                <option value="10:00">10:00 - Matin√©e</option>
                                                <option value="11:00">11:00 - Fin de matin√©e</option>
                                                <option value="13:00">13:00 - D√©but d'apr√®s-midi</option>
                                                <option value="14:00">14:00 - Apr√®s-midi</option>
                                                <option value="15:00">15:00 - Apr√®s-midi</option>
                                                <option value="16:00">16:00 - Fin d'apr√®s-midi</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label for="urgencyLevel">Niveau d'urgence :</label>
                                            <select id="urgencyLevel">
                                                <option value="normal">Normal</option>
                                                <option value="urgent">Urgent (+15$)</option>
                                                <option value="emergency">Urgence 24h (+35$)</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label for="clientNotes">Instructions sp√©ciales :</label>
                                            <textarea id="clientNotes" rows="3" placeholder="Acc√®s, cl√©s, animaux, allergies, zones prioritaires..."></textarea>
                                        </div>

                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="sendReminder"> 
                                                Recevoir un rappel 24h avant
                                            </label>
                                        </div>

                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="photoService"> 
                                                Demander des photos avant/apr√®s (+5$)
                                            </label>
                                        </div>

                                        <button type="submit" class="btn-success">‚úÖ Confirmer le rendez-vous</button>
                                        <div id="clientBookingError" class="error hidden"></div>
                                        <div id="clientBookingSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìã R√©capitulatif</h3>
                                <div id="clientBookingSummary" class="booking-form">
                                    <p>S√©lectionnez un service et une date pour voir le r√©capitulatif</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Historique -->
                    <div id="historyTab" class="tab-content">
                        <div class="data-table">
                            <h3>üìä Historique D√©taill√© de vos Services</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Note</th>
                                            <th>Co√ªt</th>
                                            <th>Photos</th>
                                        </tr>
                                    </thead>
                                    <tbody id="clientDetailedHistory">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Satisfaction -->
                    <div id="satisfactionTab" class="tab-content">
                        <div class="satisfaction-widget">
                            <h3>‚≠ê √âvaluer votre Dernier Service</h3>
                            <div id="lastServiceToRate">
                                <p>Service du 15/07/2025 - Entretien m√©nager</p>
                                <div class="satisfaction-stars">
                                    <span class="star" onclick="rateLast(1)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(2)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(3)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(4)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(5)">‚≠ê</span>
                                </div>
                                <div class="form-group">
                                    <label for="ratingComment">Commentaire (optionnel) :</label>
                                    <textarea id="ratingComment" rows="3" placeholder="Partagez votre exp√©rience..."></textarea>
                                </div>
                                <button onclick="submitRating()" class="btn-gold">Envoyer l'√©valuation</button>
                                <div id="ratingSuccess" class="success hidden"></div>
                            </div>
                        </div>

                        <div class="rating-summary">
                            <h4>üìà Vos √âvaluations</h4>
                            <div class="rating-bar">
                                <span class="rating-label">5 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 80%;"></div>
                                </div>
                                <span>80%</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">4 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 15%;"></div>
                                </div>
                                <span>15%</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">3 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 5%;"></div>
                                </div>
                                <span>5%</span>
                            </div>
                            <p style="margin-top: 15px;">
                                <strong>Moyenne g√©n√©rale : 4.8/5 ‚≠ê</strong><br>
                                <small>Bas√© sur 12 √©valuations</small>
                            </p>
                        </div>
                    </div>

                    <!-- Onglet Profil -->
                    <div id="profileTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üë§ Informations Personnelles</h3>
                                <div class="booking-form">
                                    <form id="clientProfileForm">
                                        <div class="form-group">
                                            <label for="profileName">Nom complet :</label>
                                            <input type="text" id="profileName">
                                        </div>
                                        <div class="form-group">
                                            <label for="profileEmail">Email :</label>
                                            <input type="email" id="profileEmail">
                                        </div>
                                        <div class="form-group">
                                            <label for="profilePhone">T√©l√©phone :</label>
                                            <input type="tel" id="profilePhone">
                                        </div>
                                        <div class="form-group">
                                            <label for="profileAddress">Adresse :</label>
                                            <textarea id="profileAddress" rows="3"></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="emergencyContact">Contact d'urgence :</label>
                                            <input type="text" id="emergencyContact" placeholder="Nom et t√©l√©phone">
                                        </div>
                                        <button type="submit" class="btn-gold">üíæ Mettre √† jour</button>
                                        <div id="profileSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>‚öôÔ∏è Pr√©f√©rences</h3>
                                <div class="booking-form">
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="emailNotifications" checked> 
                                            Recevoir les notifications par email
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="smsNotifications"> 
                                            Recevoir les rappels par SMS
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferredDay">Jour pr√©f√©r√© :</label>
                                        <select id="preferredDay">
                                            <option value="">Aucune pr√©f√©rence</option>
                                            <option value="monday">Lundi</option>
                                            <option value="tuesday">Mardi</option>
                                            <option value="wednesday">Mercredi</option>
                                            <option value="thursday">Jeudi</option>
                                            <option value="friday">Vendredi</option>
                                            <option value="saturday">Samedi</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferredTime">Heure pr√©f√©r√©e :</label>
                                        <select id="preferredTime">
                                            <option value="">Aucune pr√©f√©rence</option>
                                            <option value="morning">Matin (8h-12h)</option>
                                            <option value="afternoon">Apr√®s-midi (13h-17h)</option>
                                        </select>
                                    </div>
                                    <button onclick="savePreferences()" class="btn-info">‚öôÔ∏è Sauvegarder les pr√©f√©rences</button>
                                    <div id="preferencesSuccess" class="success hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interface Admin Avanc√©e -->
        <div id="adminInterface" class="hidden">
            <div id="adminAuth" class="auth-section">
                <h2>üîê Connexion Administration</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminEmail">Email administrateur :</label>
                        <input type="email" id="adminEmail" required value="admin@docshine.net">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Mot de passe :</label>
                        <input type="password" id="adminPassword" required>
                    </div>
                    <button type="submit" class="btn-gold">Acc√©der √† l'administration</button>
                    <div id="adminLoginError" class="error hidden"></div>
                </form>
            </div>

            <!-- Panel Admin Avanc√© -->
            <div id="adminPanel" class="admin-panel hidden">
                <div class="admin-header">
                    <div>
                        <h2>üîß Administration Dr. Shine Premium</h2>
                        <p>Gestion compl√®te et analytiques avanc√©es</p>
                    </div>
                    <button onclick="logout()" class="btn-warning">D√©connexion</button>
                </div>

                <div class="admin-content">
                    <!-- Statistiques Rapides Admin -->
                    <div class="quick-stats">
                        <div class="stat-card money-card">
                            <div class="number" id="adminTotalRevenue">--</div>
                            <div class="label">Chiffre d'Affaires</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="adminTotalClients">--</div>
                            <div class="label">Clients Actifs</div>
                        </div>
                        <div class="stat-card info-card">
                            <div class="number" id="adminTodayAppointments">--</div>
                            <div class="label">RDV Aujourd'hui</div>
                        </div>
                        <div class="stat-card warning-card">
                            <div class="number" id="adminAvgSatisfaction">--</div>
                            <div class="label">Satisfaction Moyenne</div>
                        </div>
                        <div class="stat-card danger-card">
                            <div class="number" id="adminLowBalanceClients">--</div>
                            <div class="label">Soldes Faibles</div>
                        </div>
                    </div>

                    <!-- Onglets Admin -->
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchAdminTab('dashboard')">üìä Dashboard</button>
                        <button class="tab-btn" onclick="switchAdminTab('clients')">üë• Clients</button>
                        <button class="tab-btn" onclick="switchAdminTab('appointments')">üìÖ Planning</button>
                        <button class="tab-btn" onclick="switchAdminTab('technicians')">üë∑ Techniciens</button>
                        <button class="tab-btn" onclick="switchAdminTab('analytics')">üìà Analytiques</button>
                        <button class="tab-btn" onclick="switchAdminTab('communications')">üìß Communications</button>
                    </div>

                    <!-- Dashboard Admin -->
                    <div id="dashboardTab" class="tab-content active">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>‚ö° Actions Rapides</h3>
                                <div class="admin-form">
                                    <button onclick="openQuickClientModal()" class="btn-success" style="width: 100%; margin-bottom: 10px;">‚ûï Nouveau Client</button>
                                    <button onclick="sendMassEmail()" class="btn-info" style="width: 100%; margin-bottom: 10px;">üìß Email de Masse</button>
                                    <button onclick="generateReport()" class="btn-warning" style="width: 100%; margin-bottom: 10px;">üìä Rapport Mensuel</button>
                                    <button onclick="backupData()" class="btn-danger" style="width: 100%;">üíæ Sauvegarde</button>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üö® Alertes</h3>
                                <div id="adminAlerts">
                                    <div class="alert alert-warning">
                                        <span class="close-btn" onclick="closeAlert(this)">√ó</span>
                                        <strong>Attention !</strong> 3 clients ont un solde inf√©rieur √† 100$.
                                    </div>
                                    <div class="alert alert-info">
                                        <span class="close-btn" onclick="closeAlert(this)">√ó</span>
                                        <strong>Info :</strong> 5 services programm√©s demain matin.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìÖ Rendez-vous d'Aujourd'hui</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Heure</th>
                                            <th>Client</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="todayAppointmentsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Gestion Clients -->
                    <div id="clientsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>‚ûï Nouveau Client</h3>
                                <div class="admin-form">
                                    <form id="newClientForm">
                                        <div class="form-group">
                                            <label for="newClientName">Nom complet :</label>
                                            <input type="text" id="newClientName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientEmail">Email :</label>
                                            <input type="email" id="newClientEmail" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientPhone">T√©l√©phone :</label>
                                            <input type="tel" id="newClientPhone" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientAddress">Adresse :</label>
                                            <textarea id="newClientAddress" rows="3" required></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="contractAmount">Montant du contrat ($) :</label>
                                            <input type="number" id="contractAmount" step="0.01" required placeholder="4000.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="totalVisits">Nombre de passages inclus :</label>
                                            <input type="number" id="totalVisits" required value="24">
                                        </div>
                                        <div class="form-group">
                                            <label for="initialPayment">Paiement initial re√ßu ($) :</label>
                                            <input type="number" id="initialPayment" step="0.01" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="clientType">Type de client :</label>
                                            <select id="clientType">
                                                <option value="residential">R√©sidentiel</option>
                                                <option value="commercial">Commercial</option>
                                                <option value="premium">Premium</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Cr√©er le client</button>
                                        <div id="newClientSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üîç Recherche Client</h3>
                                <div class="admin-form">
                                    <div class="form-group">
                                        <input type="text" id="clientSearch" placeholder="Rechercher par nom, email ou t√©l√©phone..." onkeyup="searchClients()">
                                    </div>
                                    <div id="searchResults"></div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üë• Liste Compl√®te des Clients</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Contact</th>
                                            <th>Type</th>
                                            <th>Contrat</th>
                                            <th>Passages</th>
                                            <th>Solde</th>
                                            <th>Satisfaction</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fullClientsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Planning -->
                    <div id="appointmentsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìÖ Nouveau Rendez-vous</h3>
                                <div class="admin-form">
                                    <form id="adminBookingForm">
                                        <div class="form-group">
                                            <label for="adminClientSelect">Client :</label>
                                            <select id="adminClientSelect" required>
                                                <option value="">-- Choisir un client --</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminService">Service :</label>
                                            <select id="adminService" required>
                                                <option value="">S√©lectionnez un service</option>
                                                <option value="menage">Entretien m√©nager</option>
                                                <option value="vitres">Lavage de vitres</option>
                                                <option value="auto-ext">Lavage auto ext√©rieur</option>
                                                <option value="auto-int">Lavage auto int√©rieur</option>
                                                <option value="auto-complet">Lavage auto complet</option>
                                                <option value="bacs">Lavage bacs √† ordures</option>
                                                <option value="goutieres">Nettoyage goutti√®res</option>
                                                <option value="sinistre">Nettoyage apr√®s sinistre</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminDate">Date :</label>
                                            <input type="date" id="adminDate" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminTime">Heure :</label>
                                            <input type="time" id="adminTime" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="assignedTechnician">Technicien assign√© :</label>
                                            <select id="assignedTechnician">
                                                <option value="">√Ä assigner</option>
                                                <option value="tech1">Jean-Marc L.</option>
                                                <option value="tech2">Sophie D.</option>
                                                <option value="tech3">Michel R.</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminNotes">Notes :</label>
                                            <textarea id="adminNotes" rows="3"></textarea>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Cr√©er le RDV</button>
                                        <div id="adminBookingSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìä Vue d'ensemble</h3>
                                <div class="admin-form">
                                    <div style="text-align: center;">
                                        <h4 id="planningDate">Aujourd'hui</h4>
                                        <div class="quick-stats" style="margin: 15px 0;">
                                            <div class="stat-card" style="margin: 5px;">
                                                <div class="number" id="todayTotal">--</div>
                                                <div class="label">Total RDV</div>
                                            </div>
                                            <div class="stat-card success-card" style="margin: 5px;">
                                                <div class="number" id="todayCompleted">--</div>
                                                <div class="label">Termin√©s</div>
                                            </div>
                                        </div>
                                        <button onclick="openCalendarView()" class="btn-info">üìÖ Vue Calendrier</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìÖ Tous les Rendez-vous</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Heure</th>
                                            <th>Client</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allAppointmentsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Gestion Techniciens -->
                    <div id="techniciansTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üë∑ Nouveau Technicien</h3>
                                <div class="admin-form">
                                    <form id="newTechnicianForm">
                                        <div class="form-group">
                                            <label for="techName">Nom complet :</label>
                                            <input type="text" id="techName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techEmail">Email :</label>
                                            <input type="email" id="techEmail" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techPhone">T√©l√©phone :</label>
                                            <input type="tel" id="techPhone" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techSpecialty">Sp√©cialit√© :</label>
                                            <select id="techSpecialty">
                                                <option value="all">Tous services</option>
                                                <option value="residential">R√©sidentiel</option>
                                                <option value="commercial">Commercial</option>
                                                <option value="auto">Automobile</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Ajouter</button>
                                        <div id="newTechSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìä Performance</h3>
                                <div class="admin-form">
                                    <div class="rating-summary">
                                        <h4>üèÜ Top Technicien du Mois</h4>
                                        <p><strong>Jean-Marc L.</strong></p>
                                        <p>‚≠ê 4.9/5 - 45 services</p>
                                        <p>üí∞ 3,200$ de revenus</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üë∑ √âquipe Dr. Shine</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Contact</th>
                                            <th>Sp√©cialit√©</th>
                                            <th>Services/Mois</th>
                                            <th>Note Moyenne</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="techniciansTable">
                                        <tr>
                                            <td>Jean-Marc L.</td>
                                            <td>jm.laurent@docshine.net<br>819-555-0100</td>
                                            <td>Tous services</td>
                                            <td>45</td>
                                            <td>‚≠ê 4.9</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Sophie D.</td>
                                            <td>s.dubois@docshine.net<br>819-555-0101</td>
                                            <td>R√©sidentiel</td>
                                            <td>38</td>
                                            <td>‚≠ê 4.8</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Michel R.</td>
                                            <td>m.roy@docshine.net<br>819-555-0102</td>
                                            <td>Commercial</td>
                                            <td>52</td>
                                            <td>‚≠ê 4.7</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Analytiques -->
                    <div id="analyticsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìà Revenus Mensuels</h3>
                                <div class="admin-form">
                                    <canvas id="revenueChart" width="400" height="200"></canvas>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üèÜ Services Populaires</h3>
                                <div class="admin-form">
                                    <div class="rating-bar">
                                        <span class="rating-label">M√©nage</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 45%;"></div>
                                        </div>
                                        <span>45%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Vitres</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 25%;"></div>
                                        </div>
                                        <span>25%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Auto</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 20%;"></div>
                                        </div>
                                        <span>20%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Autres</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 10%;"></div>
                                        </div>
                                        <span>10%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìä Rapport D√©taill√©</h3>
                            <div class="rating-summary">
                                <h4>üìà M√©triques Cl√©s</h4>
                                <div class="quick-stats">
                                    <div class="stat-card money-card">
                                        <div class="number">15,850$</div>
                                        <div class="label">Revenus ce mois</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="number">142</div>
                                        <div class="label">Services effectu√©s</div>
                                    </div>
                                    <div class="stat-card info-card">
                                        <div class="number">4.8‚≠ê</div>
                                        <div class="label">Satisfaction moyenne</div>
                                    </div>
                                    <div class="stat-card success-card">
                                        <div class="number">96%</div>
                                        <div class="label">Taux de fid√©lisation</div>
                                    </div>
                                </div>
                                
                                <h4 style="margin-top: 20px;">üéØ Objectifs</h4>
                                <div class="rating-bar">
                                    <span class="rating-label">Revenus (18k$)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 88%;"></div>
                                    </div>
                                    <span>88%</span>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-label">Clients (160)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 75%;"></div>
                                    </div>
                                    <span>75%</span>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-label">Satisfaction (4.9)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 98%;"></div>
                                    </div>
                                    <span>98%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communications -->
                    <div id="communicationsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìß Email de Masse</h3>
                                <div class="admin-form">
                                    <form id="massEmailForm">
                                        <div class="form-group">
                                            <label for="emailTarget">Destinataires :</label>
                                            <select id="emailTarget">
                                                <option value="all">Tous les clients</option>
                                                <option value="residential">Clients r√©sidentiels</option>
                                                <option value="commercial">Clients commerciaux</option>
                                                <option value="low_balance">Soldes faibles</option>
                                                <option value="inactive">Clients inactifs</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="massSubject">Objet :</label>
                                            <input type="text" id="massSubject" placeholder="Objet de l'email">
                                        </div>
                                        <div class="form-group">
                                            <label for="massMessage">Message :</label>
                                            <textarea id="massMessage" rows="6" placeholder="Votre message..."></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="includePromo"> 
                                                Inclure une promotion (10% de r√©duction)
                                            </label>
                                        </div>
                                        <button type="submit" class="btn-warning">üìß Envoyer √† <span id="targetCount">--</span> clients</button>
                                        <div id="massEmailSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üì± Notifications Push</h3>
                                <div class="admin-form">
                                    <div class="form-group">
                                        <label for="pushMessage">Message de notification :</label>
                                        <textarea id="pushMessage" rows="3" placeholder="Message court pour notification..."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="pushType">Type :</label>
                                        <select id="pushType">
                                            <option value="info">Information</option>
                                            <option value="promo">Promotion</option>
                                            <option value="reminder">Rappel</option>
                                            <option value="urgent">Urgent</option>
                                        </select>
                                    </div>
                                    <button onclick="sendPushNotification()" class="btn-info">üì± Envoyer</button>
                                    <div id="pushSuccess" class="success hidden"></div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìú Historique des Communications</h3>
                            <div id="communicationsHistory">
                                <div class="appointment-card">
                                    <div>
                                        <strong>Email de masse</strong> - Promotion √©t√© 2025<br>
                                        <small>Envoy√© √† 45 clients - 13/07/2025 14:30</small>
                                    </div>
                                    <span class="status-chip status-completed">Envoy√©</span>
                                </div>
                                <div class="appointment-card">
                                    <div>
                                        <strong>Rappel RDV</strong> - Pierre Tremblay<br>
                                        <small>SMS automatique - 12/07/2025 18:00</small>
                                    </div>
                                    <span class="status-chip status-completed">Livr√©</span>
                                </div>
                                <div class="appointment-card">
                                    <div>
                                        <strong>Email d'identifiants</strong> - Marie Dubois<br>
                                        <small>Nouveau client - 10/07/2025 10:15</small>
                                    </div>
                                    <span class="status-chip status-completed">Lu</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget Chat -->
        <button class="chat-toggle" onclick="toggleChat()">üí¨</button>
        <div id="chatWidget" class="chat-widget">
            <div class="chat-header">
                <span>üí¨ Support Dr. Shine</span>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 1.2rem;">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div style="padding: 10px; background: #f0f4ff; border-radius: 10px; margin-bottom: 10px;">
                    <strong>Dr. Shine Bot :</strong><br>
                    Bonjour ! Comment puis-je vous aider aujourd'hui ? üòä
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Tapez votre message..." onkeypress="handleChatEnter(event)">
                <button onclick="sendChatMessage()" class="btn-gold" style="margin-top: 10px; width: 100%;">Envoyer</button>
            </div>
        </div>

        <!-- Modals -->
        <div id="quickClientModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚ûï Nouveau Client Rapide</h3>
                    <span class="close" onclick="closeModal('quickClientModal')">&times;</span>
                </div>
                <form id="quickClientForm">
                    <div class="form-group">
                        <label for="quickName">Nom :</label>
                        <input type="text" id="quickName" required>
                    </div>
                    <div class="form-group">
                        <label for="quickEmail">Email :</label>
                        <input type="email" id="quickEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="quickPhone">T√©l√©phone :</label>
                        <input type="tel" id="quickPhone" required>
                    </div>
                    <button type="submit" class="btn-success">Cr√©er</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Base de donn√©es √©tendue
        let users = [
            {
                id: 1,
                name: "Pierre Tremblay",
                email: "pierre@example.com",
                phone: "819-555-0123",
                address: "123 Rue Principale, Gatineau, QC",
                password: "DR2025!",
                contractAmount: 4000,
                totalVisits: 24,
                usedVisits: 8,
                prepaidBalance: 2666.67,
                extraCredits: 2,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "residential",
                loyaltyPoints: 850,
                avgRating: 4.8,
                emergencyContact: "Marie Tremblay - 819-555-0124",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: false,
                    preferredDay: "tuesday",
                    preferredTime: "morning"
                }
            },
            {
                id: 2,
                name: "Marie Dubois",
                email: "marie@example.com",
                phone: "819-555-0456", 
                address: "456 Avenue des √ârables, Ottawa, ON",
                password: "DR2025!",
                contractAmount: 6000,
                totalVisits: 24,
                usedVisits: 15,
                prepaidBalance: 2250,
                extraCredits: 0,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "premium",
                loyaltyPoints: 1200,
                avgRating: 4.9,
                emergencyContact: "Paul Dubois - 819-555-0457",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: true,
                    preferredDay: "friday",
                    preferredTime: "afternoon"
                }
            },
            {
                id: 3,
                name: "Restaurant Le Gourmet",
                email: "contact@legourmet.ca",
                phone: "819-555-0789",
                address: "789 Boulevard Commercial, Gatineau, QC",
                password: "DR2025!",
                contractAmount: 8000,
                totalVisits: 24,
                usedVisits: 12,
                prepaidBalance: 2666.67,
                extraCredits: 0,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "commercial",
                loyaltyPoints: 400,
                avgRating: 4.7,
                emergencyContact: "Manager - 819-555-0790",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: false,
                    preferredDay: "monday",
                    preferredTime: "morning"
                }
            }
        ];

        let appointments = [
            {
                id: 1,
                userId: 1,
                date: "2025-07-20",
                time: "09:00",
                service: "menage",
                status: "confirmed",
                cost: 166.67,
                notes: "Attention aux plantes",
                createdAt: "2025-07-10",
                technician: "Jean-Marc L.",
                urgency: "normal",
                photoService: false,
                rating: null,
                ratingComment: ""
            },
            {
                id: 2,
                userId: 1,
                date: "2025-07-05",
                time: "14:00",
                service: "vitres",
                status: "completed",
                cost: 166.67,
                notes: "",
                createdAt: "2025-06-25",
                technician: "Sophie D.",
                urgency: "normal",
                photoService: true,
                rating: 5,
                ratingComment: "Excellent travail, tr√®s satisfait!"
            },
            {
                id: 3,
                userId: 2,
                date: "2025-07-18",
                time: "10:00",
                service: "auto-complet",
                status: "pending",
                cost: 250.00,
                notes: "V√©hicule dans l'entr√©e",
                createdAt: "2025-07-11",
                technician: "Michel R.",
                urgency: "normal",
                photoService: false,
                rating: null,
                ratingComment: ""
            },
            {
                id: 4,
                userId: 3,
                date: "2025-07-15",
                time: "07:00",
                service: "menage",
                status: "completed",
                cost: 333.33,
                notes: "Nettoyage cuisine commercial",
                createdAt: "2025-07-08",
                technician: "Jean-Marc L.",
                urgency: "normal",
                photoService: true,
                rating: 4,
                ratingComment: "Bon service"
            }
        ];

        let technicians = [
            {
                id: 1,
                name: "Jean-Marc L.",
                email: "jm.laurent@docshine.net",
                phone: "819-555-0100",
                specialty: "all",
                monthlyServices: 45,
                avgRating: 4.9,
                status: "active"
            },
            {
                id: 2,
                name: "Sophie D.",
                email: "s.dubois@docshine.net",
                phone: "819-555-0101",
                specialty: "residential",
                monthlyServices: 38,
                avgRating: 4.8,
                status: "active"
            },
            {
                id: 3,
                name: "Michel R.",
                email: "m.roy@docshine.net",
                phone: "819-555-0102",
                specialty: "commercial",
                monthlyServices: 52,
                avgRating: 4.7,
                status: "active"
            }
        ];

        let communications = [];
        let currentUser = null;
        let currentRole = null;
        let lastRating = 0;

        const adminCredentials = {
            email: "admin@docshine.net",
            password: "DrShine2025!"
        };

        const serviceNames = {
            'menage': 'Entretien m√©nager',
            'vitres': 'Lavage de vitres', 
            'auto-ext': 'Lavage auto ext√©rieur',
            'auto-int': 'Lavage auto int√©rieur',
            'auto-complet': 'Lavage auto complet',
            'bacs': 'Lavage bacs √† ordures',
            'goutieres': 'Nettoyage goutti√®res',
            'sinistre': 'Nettoyage apr√®s sinistre'
        };

        // Fonctions utilitaires
        function calculateCostPerVisit(user) {
            return user.contractAmount / user.totalVisits;
        }

        function generatePassword() {
            return "DR" + new Date().getFullYear() + "!";
        }

        function getCurrentURL() {
            return window.location.href;
        }

        function showNotification(message, type = 'info') {
            const bar = document.getElementById('notificationBar');
            bar.textContent = message;
            bar.className = `notification-bar`;
            bar.classList.remove('hidden');
            
            setTimeout(() => {
                bar.classList.add('hidden');
            }, 5000);
        }

        // Gestion des r√¥les - FONCTION CORRIG√âE
        function selectRole(role) {
            console.log('Role s√©lectionn√©:', role);
            
            // R√©initialiser l'√©tat des boutons
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            
            // Activer le bouton cliqu√©
            if (event && event.target) {
                event.target.classList.add('active');
            }
            
            // Masquer la s√©lection de r√¥le
            const roleSelection = document.getElementById('roleSelection');
            if (roleSelection) {
                roleSelection.classList.add('hidden');
            }
            
            // Afficher l'interface appropri√©e
            if (role === 'client') {
                currentRole = 'client';
                const clientInterface = document.getElementById('clientInterface');
                if (clientInterface) {
                    clientInterface.classList.remove('hidden');
                }
                showNotification('Interface client charg√©e!');
            } else if (role === 'admin') {
                currentRole = 'admin';
                const adminInterface = document.getElementById('adminInterface');
                if (adminInterface) {
                    adminInterface.classList.remove('hidden');
                }
                showNotification('Interface admin charg√©e!');
            }
        }

        // Connexion client - CORRIG√âE
        document.getElementById('clientLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Tentative de connexion client...');
            
            const email = document.getElementById('clientEmail').value;
            const password = document.getElementById('clientPassword').value;

            console.log('Email:', email, 'Password:', password);

            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                console.log('Utilisateur trouv√©:', user);
                currentUser = user;
                showClientDashboard();
                showNotification(`Bienvenue ${user.name} ! üéâ`);
            } else {
                console.log('Utilisateur non trouv√©');
                showError('clientLoginError', 'Email ou mot de passe incorrect');
            }
        });

        // Connexion admin - CORRIG√âE
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            console.log('Tentative de connexion admin...');
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            console.log('Admin Email:', email, 'Password:', password);

            if (email === adminCredentials.email && password === adminCredentials.password) {
                console.log('Admin connect√©');
                showAdminPanel();
                showNotification('Acc√®s administrateur autoris√© üîê');
            } else {
                console.log('√âchec connexion admin');
                showError('adminLoginError', 'Identifiants administrateur incorrects');
            }
        });

        function showClientDashboard() {
            console.log('Affichage dashboard client...');
            
            const clientAuth = document.getElementById('clientAuth');
            const clientDashboard = document.getElementById('clientDashboard');
            
            if (clientAuth && clientDashboard) {
                clientAuth.classList.add('hidden');
                clientDashboard.classList.remove('hidden');
                
                updateClientDashboard();
                updateClientBookingDate();
                updateLoyaltyProgram();
                loadClientUpcomingAppointments();
                
                console.log('Dashboard client affich√© avec succ√®s');
            } else {
                console.error('√âl√©ments dashboard client non trouv√©s');
            }
        }

        function showAdminPanel() {
            console.log('Affichage panel admin...');
            
            const adminAuth = document.getElementById('adminAuth');
            const adminPanel = document.getElementById('adminPanel');
            
            if (adminAuth && adminPanel) {
                adminAuth.classList.add('hidden');
                adminPanel.classList.remove('hidden');
                
                updateAdminInterface();
                
                console.log('Panel admin affich√© avec succ√®s');
            } else {
                console.error('√âl√©ments panel admin non trouv√©s');
            }
        }

;
                    if (satisfactionElement) satisfactionElement.textContent = `${currentUser.avgRating}‚≠ê`;
                    
                    // Prochain service
                    const nextAppt = appointments
                        .filter(apt => apt.userId === currentUser.id && new Date(apt.date) >= new Date())
                        .sort((a, b) => new Date(a.date) - new Date(b.date))[0];
                        
                    const nextServiceElement = document.getElementById('clientNextService');
                    if (nextServiceElement) {
                        if (nextAppt) {
                            const daysUntil = Math.ceil((new Date(nextAppt.date) - new Date()) / (1000 * 60 * 60 * 24));
                            nextServiceElement.textContent = `${daysUntil}j`;
                        } else {
                            nextServiceElement.textContent = '--';
                        }
                    }

                    loadClientDetailedHistory();
                    populateClientProfile();
                }
            } catch (error) {
                console.error('Erreur mise √† jour dashboard client:', error);
            }
        }

        // Fonctions d'aide s√©curis√©es
        function updateLoyaltyProgram() {
            try {
                const loyaltyPointsElement = document.getElementById('loyaltyPoints');
                const progressElement = document.getElementById('loyaltyProgress');
                
                if (loyaltyPointsElement && currentUser) {
                    loyaltyPointsElement.textContent = currentUser.loyaltyPoints;
                }
                
                if (progressElement && currentUser) {
                    // Animation du cercle de progression
                    const progress = (currentUser.loyaltyPoints % 1000) / 1000;
                    const circumference = 2 * Math.PI * 50;
                    const offset = circumference - (progress * circumference);
                    progressElement.style.strokeDashoffset = offset;
                }
            } catch (error) {
                console.log('Erreur mise √† jour fid√©lit√©:', error);
            }
        }

        function loadClientUpcomingAppointments() {
            try {
                const upcoming = appointments
                    .filter(apt => apt.userId === currentUser.id && new Date(apt.date) >= new Date())
                    .sort((a, b) => new Date(a.date) - new Date(b.date))
                    .slice(0, 3);
                
                const container = document.getElementById('clientUpcomingAppts');
                
                if (!container) return;
                
                if (upcoming.length === 0) {
                    container.innerHTML = '<p style="text-align: center; color: #666;">Aucun rendez-vous √† venir. R√©servez d√®s maintenant !</p>';
                    return;
                }

                container.innerHTML = upcoming.map(apt => `
                    <div class="appointment-card">
                        <div>
                            <strong>${new Date(apt.date).toLocaleDateString('fr-FR')}</strong> √† ${apt.time}<br>
                            <span>${serviceNames[apt.service]}</span><br>
                            <small>Technicien: ${apt.technician}</small>
                        </div>
                        <span class="status-chip status-${apt.status}">
                            ${apt.status === 'confirmed' ? 'Confirm√©' : 'En attente'}
                        </span>
                    </div>
                `).join('');
            } catch (error) {
                console.log('Erreur chargement RDV clients:', error);
            }
        }

        function loadClientDetailedHistory() {
            try {
                const userAppointments = appointments
                    .filter(apt => apt.userId === currentUser.id)
                    .sort((a, b) => new Date(b.date) - new Date(a.date));
                
                const tbody = document.getElementById('clientDetailedHistory');
                
                if (!tbody) return;
                
                if (userAppointments.length === 0) {
                    tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Aucun historique pour le moment</td></tr>';
                    return;
                }

                tbody.innerHTML = userAppointments.map(apt => `
                    <tr>
                        <td>${new Date(apt.date).toLocaleDateString('fr-FR')}</td>
                        <td>${serviceNames[apt.service]}</td>
                        <td>${apt.technician}</td>
                        <td><span class="status-chip status-${apt.status}">
                            ${apt.status === 'confirmed' ? 'Confirm√©' : apt.status === 'completed' ? 'Termin√©' : 'En attente'}
                        </span></td>
                        <td>${apt.rating ? apt.rating + '‚≠ê' : '--'}</td>
                        <td>${apt.cost.toFixed(2)}$</td>
                        <td>${apt.photoService ? 'üì∏ Oui' : '--'}</td>
                    </tr>
                `).join('');
            } catch (error) {
                console.log('Erreur chargement historique:', error);
            }
        }

        function populateClientProfile() {
            try {
                if (!currentUser) return;
                
                const profileName = document.getElementById('profileName');
                const profileEmail = document.getElementById('profileEmail');
                const profilePhone = document.getElementById('profilePhone');
                const profileAddress = document.getElementById('profileAddress');
                const emergencyContact = document.getElementById('emergencyContact');
                
                if (profileName) profileName.value = currentUser.name;
                if (profileEmail) profileEmail.value = currentUser.email;
                if (profilePhone) profilePhone.value = currentUser.phone;
                if (profileAddress) profileAddress.value = currentUser.address;
                if (emergencyContact) emergencyContact.value = currentUser.emergencyContact || '';
                
                // Pr√©f√©rences
                const emailNotifications = document.getElementById('emailNotifications');
                const smsNotifications = document.getElementById('smsNotifications');
                const preferredDay = document.getElementById('preferredDay');
                const preferredTime = document.getElementById('preferredTime');
                
                if (emailNotifications && currentUser.preferences) {
                    emailNotifications.checked = currentUser.preferences.emailNotifications;
                }
                if (smsNotifications && currentUser.preferences) {
                    smsNotifications.checked = currentUser.preferences.smsNotifications;
                }
                if (preferredDay && currentUser.preferences) {
                    preferredDay.value = currentUser.preferences.preferredDay;
                }
                if (preferredTime && currentUser.preferences) {
                    preferredTime.value = currentUser.preferences.preferredTime;
                }
            } catch (error) {
                console.log('Erreur population profil:', error);
            }
        }

        function updateClientBookingDate() {
            try {
                const today = new Date();
                const tomorrow = new Date(today);
                tomorrow.setDate(tomorrow.getDate() + 1);
                
                const dateElement = document.getElementById('clientDate');
                if (dateElement) {
                    dateElement.min = tomorrow.toISOString().split('T')[0];
                    dateElement.value = tomorrow.toISOString().split('T')[0];
                }
            } catch (error) {
                console.log('Erreur mise √† jour date:', error);
            }
        }

        // Fonctions d'email simplifi√©es
        function sendAppointmentConfirmationEmails(appointment) {
            try {
                const user = users.find(u => u.id === appointment.userId);
                if (user) {
                    console.log('üìß Email confirm√© √†:', user.email);
                    console.log('üìß Email admin √†: francoisfreddyateba2@gmail.com');
                    showNotification('Emails de confirmation envoy√©s!');
                }
            } catch (error) {
                console.log('Erreur envoi emails:', error);
            }
        }

        // Fonctions de chat simplifi√©es
        function toggleChat() {
            try {
                const widget = document.getElementById('chatWidget');
                const toggle = document.querySelector('.chat-toggle');
                
                if (widget && toggle) {
                    if (widget.style.display === 'none' || !widget.style.display) {
                        widget.style.display = 'block';
                        toggle.style.display = 'none';
                    } else {
                        widget.style.display = 'none';
                        toggle.style.display = 'block';
                    }
                }
            } catch (error) {
                console.log('Erreur toggle chat:', error);
            }
        }

        function openChat() {
            toggleChat();
        }

        // Autres fonctions n√©cessaires simplifi√©es
        function rateLast(stars) {
            console.log('Note donn√©e:', stars);
        }

        function submitRating() {
            console.log('√âvaluation soumise');
        }

        function savePreferences() {
            console.log('Pr√©f√©rences sauvegard√©es');
        }

        function openQuickClientModal() {
            console.log('Modal client rapide');
        }

        function closeModal(modalId) {
            const modal = document.getElementById(modalId);
            if (modal) {
                modal.style.display = 'none';
            }
        }

        function sendMassEmail() {
            console.log('Email de masse');
        }

        function generateReport() {
            console.log('Rapport g√©n√©r√©');
        }

        function backupData() {
            console.log('Sauvegarde effectu√©e');
        }

        function closeAlert(alertElement) {
            if (alertElement && alertElement.parentElement) {
                alertElement.parentElement.style.display = 'none';
            }
        }

        // R√©servation client avec fonctionnalit√©s avanc√©es
        document.getElementById('clientBookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const service = document.getElementById('clientService').value;
            const date = document.getElementById('clientDate').value;
            const time = document.getElementById('clientTime').value;
            const notes = document.getElementById('clientNotes').value;
            const urgency = document.getElementById('urgencyLevel').value;
            const photoService = document.getElementById('photoService').checked;
            
            let costPerVisit = calculateCostPerVisit(currentUser);
            
            // Calcul des frais suppl√©mentaires
            if (urgency === 'urgent') costPerVisit += 15;
            if (urgency === 'emergency') costPerVisit += 35;
            if (photoService) costPerVisit += 5;
            
            if (currentUser.prepaidBalance < costPerVisit && currentUser.extraCredits === 0) {
                showError('clientBookingError', 'Solde insuffisant. Contactez Dr. Shine pour ajouter des fonds.');
                return;
            }

            // V√©rifier disponibilit√©
            const isBooked = appointments.some(apt => 
                apt.date === date && apt.time === time && apt.status !== 'cancelled'
            );

            if (isBooked) {
                showError('clientBookingError', 'Ce cr√©neau est d√©j√† r√©serv√©. Choisissez une autre heure.');
                return;
            }

            // Assigner automatiquement un technicien
            const availableTech = technicians.find(tech => tech.status === 'active');

            const newAppointment = {
                id: appointments.length + 1,
                userId: currentUser.id,
                date: date,
                time: time,
                service: service,
                notes: notes,
                status: 'confirmed',
                cost: costPerVisit,
                createdAt: new Date().toISOString().split('T')[0],
                technician: availableTech ? availableTech.name : "√Ä assigner",
                urgency: urgency,
                photoService: photoService,
                rating: null,
                ratingComment: ""
            };

            appointments.push(newAppointment);
            
            // D√©duire du solde et ajouter des points de fid√©lit√©
            if (currentUser.extraCredits > 0) {
                currentUser.extraCredits--;
            } else {
                currentUser.usedVisits++;
                currentUser.prepaidBalance -= costPerVisit;
            }
            
            // Ajouter points de fid√©lit√© (10 points par service)
            currentUser.loyaltyPoints += 10;
            if (urgency === 'urgent') currentUser.loyaltyPoints += 5;
            if (urgency === 'emergency') currentUser.loyaltyPoints += 10;
            
            // Envoyer emails automatiques
            sendAppointmentConfirmationEmails(newAppointment);
            
            showSuccess('clientBookingSuccess', `Rendez-vous confirm√© avec succ√®s! ${photoService ? 'Photos avant/apr√®s incluses.' : ''} Dr. Shine a √©t√© notifi√©.`);
            
            document.getElementById('clientBookingForm').reset();
            updateClientDashboard();
            updateClientBookingDate();
            updateLoyaltyProgram();
            loadClientUpcomingAppointments();
            
            setTimeout(() => {
                document.getElementById('clientBookingSuccess').classList.add('hidden');
            }, 5000);
        });

        // Syst√®me de notation
        function rateLast(stars) {
            lastRating = stars;
            document.querySelectorAll('.star').forEach((star, index) => {
                star.classList.toggle('active', index < stars);
            });
        }

        function submitRating() {
            if (lastRating === 0) {
                alert('Veuillez s√©lectionner une note');
                return;
            }
            
            const comment = document.getElementById('ratingComment').value;
            
            // Trouver le dernier service completed
            const lastService = appointments
                .filter(apt => apt.userId === currentUser.id && apt.status === 'completed' && !apt.rating)
                .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
            
            if (lastService) {
                lastService.rating = lastRating;
                lastService.ratingComment = comment;
                
                // Mettre √† jour la moyenne du client
                const userRatings = appointments
                    .filter(apt => apt.userId === currentUser.id && apt.rating)
                    .map(apt => apt.rating);
                
                currentUser.avgRating = userRatings.reduce((sum, rating) => sum + rating, 0) / userRatings.length;
                
                // Ajouter points de fid√©lit√© bonus pour notation
                if (lastRating >= 4) {
                    currentUser.loyaltyPoints += 5;
                }
                
                showSuccess('ratingSuccess', 'Merci pour votre √©valuation! 5 points de fid√©lit√© ajout√©s.');
                
                // Envoyer notification √† l'entreprise
                sendRatingNotification(lastService, lastRating, comment);
                
                updateClientDashboard();
                updateLoyaltyProgram();
                
                document.getElementById('ratingComment').value = '';
                lastRating = 0;
                document.querySelectorAll('.star').forEach(star => star.classList.remove('active'));
            }
        }

        // Sauvegarde des pr√©f√©rences
        function savePreferences() {
            currentUser.preferences = {
                emailNotifications: document.getElementById('emailNotifications').checked,
                smsNotifications: document.getElementById('smsNotifications').checked,
                preferredDay: document.getElementById('preferredDay').value,
                preferredTime: document.getElementById('preferredTime').value
            };
            
            showSuccess('preferencesSuccess', 'Pr√©f√©rences sauvegard√©es avec succ√®s!');
            
            setTimeout(() => {
                document.getElementById('preferencesSuccess').classList.add('hidden');
            }, 3000);
        }

        // Mise √† jour profil client
        document.getElementById('clientProfileForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            currentUser.name = document.getElementById('profileName').value;
            currentUser.email = document.getElementById('profileEmail').value;
            currentUser.phone = document.getElementById('profilePhone').value;
            currentUser.address = document.getElementById('profileAddress').value;
            currentUser.emergencyContact = document.getElementById('emergencyContact').value;
            
            showSuccess('profileSuccess', 'Profil mis √† jour avec succ√®s!');
            updateClientDashboard();
            
            setTimeout(() => {
                document.getElementById('profileSuccess').classList.add('hidden');
            }, 3000);
        });

        // Interface Admin Avanc√©e
        function updateAdminInterface() {
            updateAdminStats();
            updateAdminDashboard();
            loadFullClientsTable();
            loadAllAppointments();
            updateClientSelects();
            loadCommunicationsHistory();
        }

        function updateAdminStats() {
            const totalRevenue = users.reduce((sum, user) => sum + (user.contractAmount - user.prepaidBalance), 0);
            const activeClients = users.length;
            const todayAppointments = appointments.filter(apt => apt.date === new Date().toISOString().split('T')[0]).length;
            const avgSatisfaction = users.reduce((sum, user) => sum + user.avgRating, 0) / users.length;
            const lowBalanceClients = users.filter(user => user.prepaidBalance < 200).length;
            
            document.getElementById('adminTotalRevenue').textContent = `${totalRevenue.toFixed(0)}<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dr. Shine - Syst√®me de Gestion Premium</title>
    <style>
        :root {
            --primary-blue: #1e3c72;
            --secondary-blue: #2a5298;
            --gold: #D4AF37;
            --light-gold: #FFD700;
            --dark-blue: #0f2347;
            --light-blue: #f0f4ff;
            --success: #28a745;
            --warning: #ffc107;
            --danger: #dc3545;
            --info: #17a2b8;
            --light-gray: #f8f9fa;
            --border-gray: #e9ecef;
            --dark-gray: #6c757d;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            line-height: 1.6;
            color: #333;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1400px;
            margin: 0 auto;
            padding: 20px;
        }

        .header {
            text-align: center;
            color: white;
            margin-bottom: 30px;
            position: relative;
        }

        .logo-container {
            display: flex;
            align-items: center;
            justify-content: center;
            margin-bottom: 20px;
        }

        .logo {
            width: 120px;
            height: 120px;
            background: white;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin-right: 20px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            position: relative;
            overflow: hidden;
        }

        .logo::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(45deg, var(--gold) 0%, var(--light-gold) 100%);
            border-radius: 50%;
            transform: scale(0.8);
        }

        .logo-text {
            position: relative;
            z-index: 2;
            color: var(--primary-blue);
            font-weight: bold;
            font-size: 1rem;
            text-align: center;
        }

        .header h1 {
            font-size: 3.5rem;
            margin-bottom: 10px;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.3);
            font-weight: bold;
            color: var(--light-gold);
        }

        .header p {
            font-size: 1.3rem;
            opacity: 0.95;
            font-style: italic;
        }

        .notification-bar {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
            color: white;
            padding: 10px;
            text-align: center;
            border-radius: 5px;
            margin-bottom: 20px;
            font-weight: 600;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {
            0% { opacity: 1; }
            50% { opacity: 0.8; }
            100% { opacity: 1; }
        }

        .auth-section, .dashboard, .admin-panel {
            background: white;
            border-radius: 20px;
            padding: 30px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.3);
            margin-bottom: 20px;
            border: 3px solid var(--gold);
        }

        .dashboard, .admin-panel {
            padding: 0;
            overflow: hidden;
        }

        .dashboard-header, .admin-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 25px 30px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 3px solid var(--gold);
        }

        .dashboard-content, .admin-content {
            padding: 30px;
        }

        .role-selector {
            display: flex;
            gap: 20px;
            margin-bottom: 30px;
            justify-content: center;
        }

        .role-btn {
            padding: 15px 30px;
            border: 2px solid var(--gold);
            background: var(--light-blue);
            color: var(--primary-blue);
            border-radius: 25px;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
        }

        .role-btn.active, .role-btn:hover {
            background: var(--gold);
            color: white;
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 15px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            text-align: center;
            border: 2px solid var(--gold);
            transition: transform 0.3s;
        }

        .stat-card:hover {
            transform: translateY(-5px);
        }

        .stat-card .number {
            font-size: 2rem;
            font-weight: bold;
            color: var(--light-gold);
            margin-bottom: 5px;
        }

        .stat-card .label {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .money-card {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
        }

        .warning-card {
            background: linear-gradient(135deg, var(--warning) 0%, #fd7e14 100%);
            color: var(--primary-blue);
        }

        .danger-card {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        }

        .info-card {
            background: linear-gradient(135deg, var(--info) 0%, #138496 100%);
        }

        .satisfaction-widget {
            background: linear-gradient(135deg, var(--light-blue) 0%, white 100%);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid var(--gold);
        }

        .satisfaction-stars {
            display: flex;
            gap: 10px;
            justify-content: center;
            margin: 15px 0;
        }

        .star {
            font-size: 2rem;
            color: #ddd;
            cursor: pointer;
            transition: color 0.3s;
        }

        .star.active, .star:hover {
            color: var(--light-gold);
        }

        .weather-widget {
            background: linear-gradient(135deg, #74b9ff 0%, #0984e3 100%);
            color: white;
            padding: 20px;
            border-radius: 15px;
            margin-bottom: 20px;
            text-align: center;
        }

        .upcoming-appointments {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border-left: 5px solid var(--gold);
        }

        .appointment-card {
            background: white;
            padding: 15px;
            border-radius: 10px;
            margin-bottom: 10px;
            border-left: 4px solid var(--primary-blue);
            display: flex;
            justify-content: space-between;
            align-items: center;
            transition: transform 0.3s;
        }

        .appointment-card:hover {
            transform: translateX(5px);
        }

        .loyalty-program {
            background: linear-gradient(135deg, var(--gold) 0%, var(--light-gold) 100%);
            color: var(--primary-blue);
            padding: 25px;
            border-radius: 15px;
            margin-bottom: 30px;
            text-align: center;
        }

        .loyalty-points {
            font-size: 3rem;
            font-weight: bold;
            margin: 10px 0;
        }

        .progress-ring {
            width: 120px;
            height: 120px;
            margin: 0 auto;
            position: relative;
        }

        .progress-ring svg {
            width: 100%;
            height: 100%;
            transform: rotate(-90deg);
        }

        .progress-ring circle {
            fill: none;
            stroke-width: 8;
            stroke-linecap: round;
        }

        .progress-ring .bg {
            stroke: rgba(255,255,255,0.3);
        }

        .progress-ring .progress {
            stroke: white;
            stroke-dasharray: 377;
            stroke-dashoffset: 377;
            transition: stroke-dashoffset 1s ease;
        }

        .chat-widget {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            background: white;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.3);
            z-index: 1000;
            border: 2px solid var(--gold);
            display: none;
        }

        .chat-header {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            padding: 15px;
            border-radius: 13px 13px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .chat-messages {
            height: 250px;
            padding: 15px;
            overflow-y: auto;
        }

        .chat-input {
            padding: 15px;
            border-top: 1px solid var(--border-gray);
        }

        .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border: none;
            border-radius: 50%;
            cursor: pointer;
            font-size: 1.5rem;
            box-shadow: 0 5px 15px rgba(0,0,0,0.3);
            z-index: 999;
        }

        .data-table {
            background: white;
            border-radius: 15px;
            padding: 25px;
            margin-bottom: 30px;
            border: 2px solid var(--border-gray);
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
        }

        .data-table h3 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 1.4rem;
            border-bottom: 2px solid var(--gold);
            padding-bottom: 10px;
        }

        .table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }

        .table th, .table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid var(--border-gray);
        }

        .table th {
            background: var(--light-blue);
            color: var(--primary-blue);
            font-weight: 600;
        }

        .table tr:hover {
            background: var(--light-gray);
        }

        .status-chip {
            display: inline-block;
            padding: 4px 12px;
            border-radius: 15px;
            font-size: 0.8rem;
            font-weight: bold;
        }

        .status-confirmed {
            background: #d4edda;
            color: #155724;
        }

        .status-pending {
            background: #fff3cd;
            color: #856404;
        }

        .status-completed {
            background: #cce5ff;
            color: #004085;
        }

        .status-cancelled {
            background: #f8d7da;
            color: #721c24;
        }

        .photo-upload {
            border: 2px dashed var(--border-gray);
            border-radius: 10px;
            padding: 20px;
            text-align: center;
            margin: 15px 0;
            cursor: pointer;
            transition: border-color 0.3s;
        }

        .photo-upload:hover {
            border-color: var(--gold);
        }

        .photo-preview {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
            margin-top: 15px;
        }

        .photo-item {
            width: 100px;
            height: 100px;
            border-radius: 10px;
            overflow: hidden;
            border: 2px solid var(--border-gray);
        }

        .photo-item img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .rating-summary {
            background: var(--light-blue);
            border-radius: 10px;
            padding: 20px;
            margin: 15px 0;
        }

        .rating-bar {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }

        .rating-label {
            width: 80px;
            font-weight: 600;
        }

        .rating-progress {
            flex: 1;
            height: 10px;
            background: var(--border-gray);
            border-radius: 5px;
            margin: 0 10px;
            overflow: hidden;
        }

        .rating-fill {
            height: 100%;
            background: var(--gold);
            transition: width 0.3s;
        }

        .alert {
            padding: 15px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
            border: 2px solid;
            position: relative;
        }

        .alert-info {
            background: var(--light-blue);
            color: var(--primary-blue);
            border-color: var(--secondary-blue);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-color: var(--warning);
        }

        .alert-success {
            background: #d4edda;
            color: #155724;
            border-color: var(--success);
        }

        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-color: var(--danger);
        }

        .alert .close-btn {
            position: absolute;
            top: 10px;
            right: 15px;
            background: none;
            border: none;
            font-size: 1.2rem;
            cursor: pointer;
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            color: var(--primary-blue);
        }

        input, select, textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid var(--border-gray);
            border-radius: 8px;
            font-size: 1rem;
            transition: border-color 0.3s;
        }

        input:focus, select:focus, textarea:focus {
            outline: none;
            border-color: var(--gold);
            box-shadow: 0 0 10px rgba(212, 175, 55, 0.3);
        }

        button {
            background: linear-gradient(135deg, var(--primary-blue) 0%, var(--secondary-blue) 100%);
            color: white;
            border: none;
            padding: 12px 25px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 1rem;
            font-weight: 600;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        button:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(30, 60, 114, 0.4);
            border-color: var(--gold);
        }

        .btn-gold {
            background: linear-gradient(135deg, var(--gold) 0%, var(--light-gold) 100%);
            color: var(--primary-blue);
        }

        .btn-success {
            background: linear-gradient(135deg, var(--success) 0%, #20c997 100%);
        }

        .btn-warning {
            background: linear-gradient(135deg, var(--warning) 0%, #fd7e14 100%);
            color: var(--primary-blue);
        }

        .btn-danger {
            background: linear-gradient(135deg, var(--danger) 0%, #c82333 100%);
        }

        .btn-info {
            background: linear-gradient(135deg, var(--info) 0%, #138496 100%);
        }

        .tabs {
            display: flex;
            margin-bottom: 30px;
            border-bottom: 3px solid var(--gold);
            background: var(--light-blue);
            border-radius: 10px 10px 0 0;
            overflow: hidden;
        }

        .tab-btn {
            flex: 1;
            padding: 15px;
            border: none;
            background: transparent;
            cursor: pointer;
            font-size: 1.1rem;
            font-weight: 600;
            transition: all 0.3s;
            color: var(--primary-blue);
        }

        .tab-btn.active {
            background: var(--gold);
            color: white;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .services-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 25px;
            margin-bottom: 40px;
        }

        .service-section {
            background: var(--light-gray);
            border-radius: 15px;
            padding: 25px;
            border-left: 5px solid var(--gold);
            border: 2px solid var(--border-gray);
        }

        .service-section h3 {
            color: var(--primary-blue);
            margin-bottom: 20px;
            font-size: 1.4rem;
        }

        .booking-form, .admin-form {
            background: white;
            border-radius: 10px;
            padding: 20px;
            border: 2px solid var(--border-gray);
        }

        .hidden {
            display: none;
        }

        .error {
            color: var(--danger);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .success {
            color: var(--success);
            font-size: 0.9rem;
            margin-top: 5px;
        }

        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
        }

        .modal-content {
            background-color: white;
            margin: 15% auto;
            padding: 20px;
            border-radius: 15px;
            width: 90%;
            max-width: 500px;
            border: 3px solid var(--gold);
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--gold);
        }

        .close {
            color: var(--dark-gray);
            float: right;
            font-size: 28px;
            font-weight: bold;
            cursor: pointer;
        }

        .close:hover {
            color: var(--danger);
        }

        @media (max-width: 768px) {
            .quick-stats, .services-grid {
                grid-template-columns: 1fr;
            }
            
            .header h1 {
                font-size: 2.5rem;
            }

            .logo-container {
                flex-direction: column;
                text-align: center;
            }

            .logo {
                margin-right: 0;
                margin-bottom: 15px;
            }

            .role-selector {
                flex-direction: column;
            }

            .chat-widget {
                width: 90%;
                right: 5%;
            }

            .appointment-card {
                flex-direction: column;
                align-items: flex-start;
                gap: 10px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <div class="logo-container">
                <div class="logo">
                    <div class="logo-text">DR.<br>SHINE</div>
                </div>
                <div>
                    <h1>Dr. Shine</h1>
                    <p>Syst√®me de Gestion Premium</p>
                </div>
            </div>
        </div>

        <!-- Barre de notifications -->
        <div id="notificationBar" class="notification-bar hidden">
            üì¢ Nouveau message ou alerte importante !
        </div>

        <!-- S√©lection du r√¥le -->
        <div id="roleSelection" class="auth-section">
            <div class="role-selector">
                <button class="role-btn" onclick="selectRole('client')">
                    üë§ Espace Client Premium
                </button>
                <button class="role-btn" onclick="selectRole('admin')">
                    üîß Administration Avanc√©e
                </button>
            </div>
        </div>

        <!-- Interface Client Premium -->
        <div id="clientInterface" class="hidden">
            <div id="clientAuth" class="auth-section">
                <h2>üîê Connexion Client</h2>
                <div class="alert alert-info">
                    <strong>Bienvenue chez Dr. Shine !</strong><br>
                    Vos identifiants vous ont √©t√© envoy√©s par email. En cas de probl√®me, contactez-nous au 819-918-5041.
                </div>
                <form id="clientLoginForm">
                    <div class="form-group">
                        <label for="clientEmail">Email :</label>
                        <input type="email" id="clientEmail" required placeholder="votre.email@exemple.com">
                    </div>
                    <div class="form-group">
                        <label for="clientPassword">Mot de passe :</label>
                        <input type="password" id="clientPassword" required>
                    </div>
                    <button type="submit" class="btn-gold">Se connecter</button>
                    <div id="clientLoginError" class="error hidden"></div>
                </form>
            </div>

            <!-- Dashboard Client Premium -->
            <div id="clientDashboard" class="dashboard hidden">
                <div class="dashboard-header">
                    <div>
                        <h2 id="clientWelcome">Bienvenue</h2>
                        <p id="clientInfo"></p>
                    </div>
                    <div>
                        <button onclick="openChat()" class="btn-info" style="margin-right: 10px;">üí¨ Chat</button>
                        <button onclick="logout()" class="btn-warning">D√©connexion</button>
                    </div>
                </div>

                <div class="dashboard-content">
                    <!-- Widget M√©t√©o -->
                    <div class="weather-widget">
                        <h3>üå§Ô∏è M√©t√©o du Jour</h3>
                        <div id="weatherInfo">
                            <p>Parfait pour nos services ! ‚òÄÔ∏è 22¬∞C</p>
                            <small>Id√©al pour le lavage ext√©rieur</small>
                        </div>
                    </div>

                    <!-- Stats Rapides -->
                    <div class="quick-stats">
                        <div class="stat-card">
                            <div class="number" id="clientPassagesLeft">--</div>
                            <div class="label">Passages Restants</div>
                        </div>
                        <div class="stat-card money-card">
                            <div class="number" id="clientBalanceAmount">--</div>
                            <div class="label">Solde Disponible</div>
                        </div>
                        <div class="stat-card info-card">
                            <div class="number" id="clientSatisfactionScore">--</div>
                            <div class="label">Satisfaction Moyenne</div>
                        </div>
                        <div class="stat-card warning-card">
                            <div class="number" id="clientNextService">--</div>
                            <div class="label">Prochain Service</div>
                        </div>
                    </div>

                    <!-- Programme de Fid√©lit√© -->
                    <div class="loyalty-program">
                        <h3>üèÜ Programme de Fid√©lit√© Dr. Shine</h3>
                        <div class="loyalty-points" id="loyaltyPoints">850</div>
                        <p>Points de fid√©lit√©</p>
                        <div class="progress-ring">
                            <svg>
                                <circle class="bg" cx="60" cy="60" r="50"></circle>
                                <circle class="progress" cx="60" cy="60" r="50" id="loyaltyProgress"></circle>
                            </svg>
                        </div>
                        <p style="margin-top: 10px;">150 points = 1 service gratuit !</p>
                    </div>

                    <!-- Rendez-vous √† venir -->
                    <div class="upcoming-appointments">
                        <h3>üìÖ Vos Prochains Rendez-vous</h3>
                        <div id="clientUpcomingAppts">
                            <!-- G√©n√©r√© dynamiquement -->
                        </div>
                    </div>

                    <!-- Onglets Client -->
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchClientTab('book')">üìÖ R√©server</button>
                        <button class="tab-btn" onclick="switchClientTab('history')">üìä Historique</button>
                        <button class="tab-btn" onclick="switchClientTab('satisfaction')">‚≠ê Satisfaction</button>
                        <button class="tab-btn" onclick="switchClientTab('profile')">üë§ Profil</button>
                    </div>

                    <!-- Onglet R√©servation -->
                    <div id="bookTab" class="tab-content active">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìÖ R√©server un Service</h3>
                                <div class="booking-form">
                                    <form id="clientBookingForm">
                                        <div class="form-group">
                                            <label for="clientService">Service souhait√© :</label>
                                            <select id="clientService" required>
                                                <option value="">S√©lectionnez un service</option>
                                                <option value="menage">üè† Entretien m√©nager</option>
                                                <option value="vitres">ü™ü Lavage de vitres</option>
                                                <option value="auto-ext">üöó Lavage auto ext√©rieur</option>
                                                <option value="auto-int">üöô Lavage auto int√©rieur</option>
                                                <option value="auto-complet">‚ú® Lavage auto complet</option>
                                                <option value="bacs">üóëÔ∏è Lavage bacs √† ordures</option>
                                                <option value="goutieres">üèòÔ∏è Nettoyage goutti√®res</option>
                                                <option value="sinistre">üîß Nettoyage apr√®s sinistre</option>
                                            </select>
                                        </div>
                                        
                                        <div class="form-group">
                                            <label for="clientDate">Date souhait√©e :</label>
                                            <input type="date" id="clientDate" required>
                                        </div>

                                        <div class="form-group">
                                            <label for="clientTime">Heure pr√©f√©r√©e :</label>
                                            <select id="clientTime" required>
                                                <option value="">S√©lectionnez un cr√©neau</option>
                                                <option value="08:00">08:00 - Matin√©e</option>
                                                <option value="09:00">09:00 - Matin√©e</option>
                                                <option value="10:00">10:00 - Matin√©e</option>
                                                <option value="11:00">11:00 - Fin de matin√©e</option>
                                                <option value="13:00">13:00 - D√©but d'apr√®s-midi</option>
                                                <option value="14:00">14:00 - Apr√®s-midi</option>
                                                <option value="15:00">15:00 - Apr√®s-midi</option>
                                                <option value="16:00">16:00 - Fin d'apr√®s-midi</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label for="urgencyLevel">Niveau d'urgence :</label>
                                            <select id="urgencyLevel">
                                                <option value="normal">Normal</option>
                                                <option value="urgent">Urgent (+15$)</option>
                                                <option value="emergency">Urgence 24h (+35$)</option>
                                            </select>
                                        </div>

                                        <div class="form-group">
                                            <label for="clientNotes">Instructions sp√©ciales :</label>
                                            <textarea id="clientNotes" rows="3" placeholder="Acc√®s, cl√©s, animaux, allergies, zones prioritaires..."></textarea>
                                        </div>

                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="sendReminder"> 
                                                Recevoir un rappel 24h avant
                                            </label>
                                        </div>

                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="photoService"> 
                                                Demander des photos avant/apr√®s (+5$)
                                            </label>
                                        </div>

                                        <button type="submit" class="btn-success">‚úÖ Confirmer le rendez-vous</button>
                                        <div id="clientBookingError" class="error hidden"></div>
                                        <div id="clientBookingSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìã R√©capitulatif</h3>
                                <div id="clientBookingSummary" class="booking-form">
                                    <p>S√©lectionnez un service et une date pour voir le r√©capitulatif</p>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Historique -->
                    <div id="historyTab" class="tab-content">
                        <div class="data-table">
                            <h3>üìä Historique D√©taill√© de vos Services</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Note</th>
                                            <th>Co√ªt</th>
                                            <th>Photos</th>
                                        </tr>
                                    </thead>
                                    <tbody id="clientDetailedHistory">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Onglet Satisfaction -->
                    <div id="satisfactionTab" class="tab-content">
                        <div class="satisfaction-widget">
                            <h3>‚≠ê √âvaluer votre Dernier Service</h3>
                            <div id="lastServiceToRate">
                                <p>Service du 15/07/2025 - Entretien m√©nager</p>
                                <div class="satisfaction-stars">
                                    <span class="star" onclick="rateLast(1)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(2)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(3)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(4)">‚≠ê</span>
                                    <span class="star" onclick="rateLast(5)">‚≠ê</span>
                                </div>
                                <div class="form-group">
                                    <label for="ratingComment">Commentaire (optionnel) :</label>
                                    <textarea id="ratingComment" rows="3" placeholder="Partagez votre exp√©rience..."></textarea>
                                </div>
                                <button onclick="submitRating()" class="btn-gold">Envoyer l'√©valuation</button>
                                <div id="ratingSuccess" class="success hidden"></div>
                            </div>
                        </div>

                        <div class="rating-summary">
                            <h4>üìà Vos √âvaluations</h4>
                            <div class="rating-bar">
                                <span class="rating-label">5 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 80%;"></div>
                                </div>
                                <span>80%</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">4 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 15%;"></div>
                                </div>
                                <span>15%</span>
                            </div>
                            <div class="rating-bar">
                                <span class="rating-label">3 √©toiles</span>
                                <div class="rating-progress">
                                    <div class="rating-fill" style="width: 5%;"></div>
                                </div>
                                <span>5%</span>
                            </div>
                            <p style="margin-top: 15px;">
                                <strong>Moyenne g√©n√©rale : 4.8/5 ‚≠ê</strong><br>
                                <small>Bas√© sur 12 √©valuations</small>
                            </p>
                        </div>
                    </div>

                    <!-- Onglet Profil -->
                    <div id="profileTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üë§ Informations Personnelles</h3>
                                <div class="booking-form">
                                    <form id="clientProfileForm">
                                        <div class="form-group">
                                            <label for="profileName">Nom complet :</label>
                                            <input type="text" id="profileName">
                                        </div>
                                        <div class="form-group">
                                            <label for="profileEmail">Email :</label>
                                            <input type="email" id="profileEmail">
                                        </div>
                                        <div class="form-group">
                                            <label for="profilePhone">T√©l√©phone :</label>
                                            <input type="tel" id="profilePhone">
                                        </div>
                                        <div class="form-group">
                                            <label for="profileAddress">Adresse :</label>
                                            <textarea id="profileAddress" rows="3"></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="emergencyContact">Contact d'urgence :</label>
                                            <input type="text" id="emergencyContact" placeholder="Nom et t√©l√©phone">
                                        </div>
                                        <button type="submit" class="btn-gold">üíæ Mettre √† jour</button>
                                        <div id="profileSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>‚öôÔ∏è Pr√©f√©rences</h3>
                                <div class="booking-form">
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="emailNotifications" checked> 
                                            Recevoir les notifications par email
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label>
                                            <input type="checkbox" id="smsNotifications"> 
                                            Recevoir les rappels par SMS
                                        </label>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferredDay">Jour pr√©f√©r√© :</label>
                                        <select id="preferredDay">
                                            <option value="">Aucune pr√©f√©rence</option>
                                            <option value="monday">Lundi</option>
                                            <option value="tuesday">Mardi</option>
                                            <option value="wednesday">Mercredi</option>
                                            <option value="thursday">Jeudi</option>
                                            <option value="friday">Vendredi</option>
                                            <option value="saturday">Samedi</option>
                                        </select>
                                    </div>
                                    <div class="form-group">
                                        <label for="preferredTime">Heure pr√©f√©r√©e :</label>
                                        <select id="preferredTime">
                                            <option value="">Aucune pr√©f√©rence</option>
                                            <option value="morning">Matin (8h-12h)</option>
                                            <option value="afternoon">Apr√®s-midi (13h-17h)</option>
                                        </select>
                                    </div>
                                    <button onclick="savePreferences()" class="btn-info">‚öôÔ∏è Sauvegarder les pr√©f√©rences</button>
                                    <div id="preferencesSuccess" class="success hidden"></div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Interface Admin Avanc√©e -->
        <div id="adminInterface" class="hidden">
            <div id="adminAuth" class="auth-section">
                <h2>üîê Connexion Administration</h2>
                <form id="adminLoginForm">
                    <div class="form-group">
                        <label for="adminEmail">Email administrateur :</label>
                        <input type="email" id="adminEmail" required value="admin@docshine.net">
                    </div>
                    <div class="form-group">
                        <label for="adminPassword">Mot de passe :</label>
                        <input type="password" id="adminPassword" required>
                    </div>
                    <button type="submit" class="btn-gold">Acc√©der √† l'administration</button>
                    <div id="adminLoginError" class="error hidden"></div>
                </form>
            </div>

            <!-- Panel Admin Avanc√© -->
            <div id="adminPanel" class="admin-panel hidden">
                <div class="admin-header">
                    <div>
                        <h2>üîß Administration Dr. Shine Premium</h2>
                        <p>Gestion compl√®te et analytiques avanc√©es</p>
                    </div>
                    <button onclick="logout()" class="btn-warning">D√©connexion</button>
                </div>

                <div class="admin-content">
                    <!-- Statistiques Rapides Admin -->
                    <div class="quick-stats">
                        <div class="stat-card money-card">
                            <div class="number" id="adminTotalRevenue">--</div>
                            <div class="label">Chiffre d'Affaires</div>
                        </div>
                        <div class="stat-card">
                            <div class="number" id="adminTotalClients">--</div>
                            <div class="label">Clients Actifs</div>
                        </div>
                        <div class="stat-card info-card">
                            <div class="number" id="adminTodayAppointments">--</div>
                            <div class="label">RDV Aujourd'hui</div>
                        </div>
                        <div class="stat-card warning-card">
                            <div class="number" id="adminAvgSatisfaction">--</div>
                            <div class="label">Satisfaction Moyenne</div>
                        </div>
                        <div class="stat-card danger-card">
                            <div class="number" id="adminLowBalanceClients">--</div>
                            <div class="label">Soldes Faibles</div>
                        </div>
                    </div>

                    <!-- Onglets Admin -->
                    <div class="tabs">
                        <button class="tab-btn active" onclick="switchAdminTab('dashboard')">üìä Dashboard</button>
                        <button class="tab-btn" onclick="switchAdminTab('clients')">üë• Clients</button>
                        <button class="tab-btn" onclick="switchAdminTab('appointments')">üìÖ Planning</button>
                        <button class="tab-btn" onclick="switchAdminTab('technicians')">üë∑ Techniciens</button>
                        <button class="tab-btn" onclick="switchAdminTab('analytics')">üìà Analytiques</button>
                        <button class="tab-btn" onclick="switchAdminTab('communications')">üìß Communications</button>
                    </div>

                    <!-- Dashboard Admin -->
                    <div id="dashboardTab" class="tab-content active">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>‚ö° Actions Rapides</h3>
                                <div class="admin-form">
                                    <button onclick="openQuickClientModal()" class="btn-success" style="width: 100%; margin-bottom: 10px;">‚ûï Nouveau Client</button>
                                    <button onclick="sendMassEmail()" class="btn-info" style="width: 100%; margin-bottom: 10px;">üìß Email de Masse</button>
                                    <button onclick="generateReport()" class="btn-warning" style="width: 100%; margin-bottom: 10px;">üìä Rapport Mensuel</button>
                                    <button onclick="backupData()" class="btn-danger" style="width: 100%;">üíæ Sauvegarde</button>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üö® Alertes</h3>
                                <div id="adminAlerts">
                                    <div class="alert alert-warning">
                                        <span class="close-btn" onclick="closeAlert(this)">√ó</span>
                                        <strong>Attention !</strong> 3 clients ont un solde inf√©rieur √† 100$.
                                    </div>
                                    <div class="alert alert-info">
                                        <span class="close-btn" onclick="closeAlert(this)">√ó</span>
                                        <strong>Info :</strong> 5 services programm√©s demain matin.
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìÖ Rendez-vous d'Aujourd'hui</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Heure</th>
                                            <th>Client</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="todayAppointmentsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Gestion Clients -->
                    <div id="clientsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>‚ûï Nouveau Client</h3>
                                <div class="admin-form">
                                    <form id="newClientForm">
                                        <div class="form-group">
                                            <label for="newClientName">Nom complet :</label>
                                            <input type="text" id="newClientName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientEmail">Email :</label>
                                            <input type="email" id="newClientEmail" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientPhone">T√©l√©phone :</label>
                                            <input type="tel" id="newClientPhone" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="newClientAddress">Adresse :</label>
                                            <textarea id="newClientAddress" rows="3" required></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label for="contractAmount">Montant du contrat ($) :</label>
                                            <input type="number" id="contractAmount" step="0.01" required placeholder="4000.00">
                                        </div>
                                        <div class="form-group">
                                            <label for="totalVisits">Nombre de passages inclus :</label>
                                            <input type="number" id="totalVisits" required value="24">
                                        </div>
                                        <div class="form-group">
                                            <label for="initialPayment">Paiement initial re√ßu ($) :</label>
                                            <input type="number" id="initialPayment" step="0.01" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="clientType">Type de client :</label>
                                            <select id="clientType">
                                                <option value="residential">R√©sidentiel</option>
                                                <option value="commercial">Commercial</option>
                                                <option value="premium">Premium</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Cr√©er le client</button>
                                        <div id="newClientSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üîç Recherche Client</h3>
                                <div class="admin-form">
                                    <div class="form-group">
                                        <input type="text" id="clientSearch" placeholder="Rechercher par nom, email ou t√©l√©phone..." onkeyup="searchClients()">
                                    </div>
                                    <div id="searchResults"></div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üë• Liste Compl√®te des Clients</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Contact</th>
                                            <th>Type</th>
                                            <th>Contrat</th>
                                            <th>Passages</th>
                                            <th>Solde</th>
                                            <th>Satisfaction</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="fullClientsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Planning -->
                    <div id="appointmentsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìÖ Nouveau Rendez-vous</h3>
                                <div class="admin-form">
                                    <form id="adminBookingForm">
                                        <div class="form-group">
                                            <label for="adminClientSelect">Client :</label>
                                            <select id="adminClientSelect" required>
                                                <option value="">-- Choisir un client --</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminService">Service :</label>
                                            <select id="adminService" required>
                                                <option value="">S√©lectionnez un service</option>
                                                <option value="menage">Entretien m√©nager</option>
                                                <option value="vitres">Lavage de vitres</option>
                                                <option value="auto-ext">Lavage auto ext√©rieur</option>
                                                <option value="auto-int">Lavage auto int√©rieur</option>
                                                <option value="auto-complet">Lavage auto complet</option>
                                                <option value="bacs">Lavage bacs √† ordures</option>
                                                <option value="goutieres">Nettoyage goutti√®res</option>
                                                <option value="sinistre">Nettoyage apr√®s sinistre</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminDate">Date :</label>
                                            <input type="date" id="adminDate" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminTime">Heure :</label>
                                            <input type="time" id="adminTime" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="assignedTechnician">Technicien assign√© :</label>
                                            <select id="assignedTechnician">
                                                <option value="">√Ä assigner</option>
                                                <option value="tech1">Jean-Marc L.</option>
                                                <option value="tech2">Sophie D.</option>
                                                <option value="tech3">Michel R.</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="adminNotes">Notes :</label>
                                            <textarea id="adminNotes" rows="3"></textarea>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Cr√©er le RDV</button>
                                        <div id="adminBookingSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìä Vue d'ensemble</h3>
                                <div class="admin-form">
                                    <div style="text-align: center;">
                                        <h4 id="planningDate">Aujourd'hui</h4>
                                        <div class="quick-stats" style="margin: 15px 0;">
                                            <div class="stat-card" style="margin: 5px;">
                                                <div class="number" id="todayTotal">--</div>
                                                <div class="label">Total RDV</div>
                                            </div>
                                            <div class="stat-card success-card" style="margin: 5px;">
                                                <div class="number" id="todayCompleted">--</div>
                                                <div class="label">Termin√©s</div>
                                            </div>
                                        </div>
                                        <button onclick="openCalendarView()" class="btn-info">üìÖ Vue Calendrier</button>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìÖ Tous les Rendez-vous</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Date</th>
                                            <th>Heure</th>
                                            <th>Client</th>
                                            <th>Service</th>
                                            <th>Technicien</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="allAppointmentsTable">
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Gestion Techniciens -->
                    <div id="techniciansTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üë∑ Nouveau Technicien</h3>
                                <div class="admin-form">
                                    <form id="newTechnicianForm">
                                        <div class="form-group">
                                            <label for="techName">Nom complet :</label>
                                            <input type="text" id="techName" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techEmail">Email :</label>
                                            <input type="email" id="techEmail" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techPhone">T√©l√©phone :</label>
                                            <input type="tel" id="techPhone" required>
                                        </div>
                                        <div class="form-group">
                                            <label for="techSpecialty">Sp√©cialit√© :</label>
                                            <select id="techSpecialty">
                                                <option value="all">Tous services</option>
                                                <option value="residential">R√©sidentiel</option>
                                                <option value="commercial">Commercial</option>
                                                <option value="auto">Automobile</option>
                                            </select>
                                        </div>
                                        <button type="submit" class="btn-success">‚úÖ Ajouter</button>
                                        <div id="newTechSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üìä Performance</h3>
                                <div class="admin-form">
                                    <div class="rating-summary">
                                        <h4>üèÜ Top Technicien du Mois</h4>
                                        <p><strong>Jean-Marc L.</strong></p>
                                        <p>‚≠ê 4.9/5 - 45 services</p>
                                        <p>üí∞ 3,200$ de revenus</p>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üë∑ √âquipe Dr. Shine</h3>
                            <div style="overflow-x: auto;">
                                <table class="table">
                                    <thead>
                                        <tr>
                                            <th>Nom</th>
                                            <th>Contact</th>
                                            <th>Sp√©cialit√©</th>
                                            <th>Services/Mois</th>
                                            <th>Note Moyenne</th>
                                            <th>Statut</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody id="techniciansTable">
                                        <tr>
                                            <td>Jean-Marc L.</td>
                                            <td>jm.laurent@docshine.net<br>819-555-0100</td>
                                            <td>Tous services</td>
                                            <td>45</td>
                                            <td>‚≠ê 4.9</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Sophie D.</td>
                                            <td>s.dubois@docshine.net<br>819-555-0101</td>
                                            <td>R√©sidentiel</td>
                                            <td>38</td>
                                            <td>‚≠ê 4.8</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                        <tr>
                                            <td>Michel R.</td>
                                            <td>m.roy@docshine.net<br>819-555-0102</td>
                                            <td>Commercial</td>
                                            <td>52</td>
                                            <td>‚≠ê 4.7</td>
                                            <td><span class="status-chip status-confirmed">Actif</span></td>
                                            <td>
                                                <button class="btn-info" style="font-size: 0.8rem; padding: 5px 10px;">üìä D√©tails</button>
                                            </td>
                                        </tr>
                                    </tbody>
                                </table>
                            </div>
                        </div>
                    </div>

                    <!-- Analytiques -->
                    <div id="analyticsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìà Revenus Mensuels</h3>
                                <div class="admin-form">
                                    <canvas id="revenueChart" width="400" height="200"></canvas>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üèÜ Services Populaires</h3>
                                <div class="admin-form">
                                    <div class="rating-bar">
                                        <span class="rating-label">M√©nage</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 45%;"></div>
                                        </div>
                                        <span>45%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Vitres</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 25%;"></div>
                                        </div>
                                        <span>25%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Auto</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 20%;"></div>
                                        </div>
                                        <span>20%</span>
                                    </div>
                                    <div class="rating-bar">
                                        <span class="rating-label">Autres</span>
                                        <div class="rating-progress">
                                            <div class="rating-fill" style="width: 10%;"></div>
                                        </div>
                                        <span>10%</span>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìä Rapport D√©taill√©</h3>
                            <div class="rating-summary">
                                <h4>üìà M√©triques Cl√©s</h4>
                                <div class="quick-stats">
                                    <div class="stat-card money-card">
                                        <div class="number">15,850$</div>
                                        <div class="label">Revenus ce mois</div>
                                    </div>
                                    <div class="stat-card">
                                        <div class="number">142</div>
                                        <div class="label">Services effectu√©s</div>
                                    </div>
                                    <div class="stat-card info-card">
                                        <div class="number">4.8‚≠ê</div>
                                        <div class="label">Satisfaction moyenne</div>
                                    </div>
                                    <div class="stat-card success-card">
                                        <div class="number">96%</div>
                                        <div class="label">Taux de fid√©lisation</div>
                                    </div>
                                </div>
                                
                                <h4 style="margin-top: 20px;">üéØ Objectifs</h4>
                                <div class="rating-bar">
                                    <span class="rating-label">Revenus (18k$)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 88%;"></div>
                                    </div>
                                    <span>88%</span>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-label">Clients (160)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 75%;"></div>
                                    </div>
                                    <span>75%</span>
                                </div>
                                <div class="rating-bar">
                                    <span class="rating-label">Satisfaction (4.9)</span>
                                    <div class="rating-progress">
                                        <div class="rating-fill" style="width: 98%;"></div>
                                    </div>
                                    <span>98%</span>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Communications -->
                    <div id="communicationsTab" class="tab-content">
                        <div class="services-grid">
                            <div class="service-section">
                                <h3>üìß Email de Masse</h3>
                                <div class="admin-form">
                                    <form id="massEmailForm">
                                        <div class="form-group">
                                            <label for="emailTarget">Destinataires :</label>
                                            <select id="emailTarget">
                                                <option value="all">Tous les clients</option>
                                                <option value="residential">Clients r√©sidentiels</option>
                                                <option value="commercial">Clients commerciaux</option>
                                                <option value="low_balance">Soldes faibles</option>
                                                <option value="inactive">Clients inactifs</option>
                                            </select>
                                        </div>
                                        <div class="form-group">
                                            <label for="massSubject">Objet :</label>
                                            <input type="text" id="massSubject" placeholder="Objet de l'email">
                                        </div>
                                        <div class="form-group">
                                            <label for="massMessage">Message :</label>
                                            <textarea id="massMessage" rows="6" placeholder="Votre message..."></textarea>
                                        </div>
                                        <div class="form-group">
                                            <label>
                                                <input type="checkbox" id="includePromo"> 
                                                Inclure une promotion (10% de r√©duction)
                                            </label>
                                        </div>
                                        <button type="submit" class="btn-warning">üìß Envoyer √† <span id="targetCount">--</span> clients</button>
                                        <div id="massEmailSuccess" class="success hidden"></div>
                                    </form>
                                </div>
                            </div>

                            <div class="service-section">
                                <h3>üì± Notifications Push</h3>
                                <div class="admin-form">
                                    <div class="form-group">
                                        <label for="pushMessage">Message de notification :</label>
                                        <textarea id="pushMessage" rows="3" placeholder="Message court pour notification..."></textarea>
                                    </div>
                                    <div class="form-group">
                                        <label for="pushType">Type :</label>
                                        <select id="pushType">
                                            <option value="info">Information</option>
                                            <option value="promo">Promotion</option>
                                            <option value="reminder">Rappel</option>
                                            <option value="urgent">Urgent</option>
                                        </select>
                                    </div>
                                    <button onclick="sendPushNotification()" class="btn-info">üì± Envoyer</button>
                                    <div id="pushSuccess" class="success hidden"></div>
                                </div>
                            </div>
                        </div>

                        <div class="data-table">
                            <h3>üìú Historique des Communications</h3>
                            <div id="communicationsHistory">
                                <div class="appointment-card">
                                    <div>
                                        <strong>Email de masse</strong> - Promotion √©t√© 2025<br>
                                        <small>Envoy√© √† 45 clients - 13/07/2025 14:30</small>
                                    </div>
                                    <span class="status-chip status-completed">Envoy√©</span>
                                </div>
                                <div class="appointment-card">
                                    <div>
                                        <strong>Rappel RDV</strong> - Pierre Tremblay<br>
                                        <small>SMS automatique - 12/07/2025 18:00</small>
                                    </div>
                                    <span class="status-chip status-completed">Livr√©</span>
                                </div>
                                <div class="appointment-card">
                                    <div>
                                        <strong>Email d'identifiants</strong> - Marie Dubois<br>
                                        <small>Nouveau client - 10/07/2025 10:15</small>
                                    </div>
                                    <span class="status-chip status-completed">Lu</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Widget Chat -->
        <button class="chat-toggle" onclick="toggleChat()">üí¨</button>
        <div id="chatWidget" class="chat-widget">
            <div class="chat-header">
                <span>üí¨ Support Dr. Shine</span>
                <button onclick="toggleChat()" style="background: none; border: none; color: white; font-size: 1.2rem;">√ó</button>
            </div>
            <div class="chat-messages" id="chatMessages">
                <div style="padding: 10px; background: #f0f4ff; border-radius: 10px; margin-bottom: 10px;">
                    <strong>Dr. Shine Bot :</strong><br>
                    Bonjour ! Comment puis-je vous aider aujourd'hui ? üòä
                </div>
            </div>
            <div class="chat-input">
                <input type="text" id="chatInput" placeholder="Tapez votre message..." onkeypress="handleChatEnter(event)">
                <button onclick="sendChatMessage()" class="btn-gold" style="margin-top: 10px; width: 100%;">Envoyer</button>
            </div>
        </div>

        <!-- Modals -->
        <div id="quickClientModal" class="modal">
            <div class="modal-content">
                <div class="modal-header">
                    <h3>‚ûï Nouveau Client Rapide</h3>
                    <span class="close" onclick="closeModal('quickClientModal')">&times;</span>
                </div>
                <form id="quickClientForm">
                    <div class="form-group">
                        <label for="quickName">Nom :</label>
                        <input type="text" id="quickName" required>
                    </div>
                    <div class="form-group">
                        <label for="quickEmail">Email :</label>
                        <input type="email" id="quickEmail" required>
                    </div>
                    <div class="form-group">
                        <label for="quickPhone">T√©l√©phone :</label>
                        <input type="tel" id="quickPhone" required>
                    </div>
                    <button type="submit" class="btn-success">Cr√©er</button>
                </form>
            </div>
        </div>
    </div>

    <script>
        // Base de donn√©es √©tendue
        let users = [
            {
                id: 1,
                name: "Pierre Tremblay",
                email: "pierre@example.com",
                phone: "819-555-0123",
                address: "123 Rue Principale, Gatineau, QC",
                password: "DR2025!",
                contractAmount: 4000,
                totalVisits: 24,
                usedVisits: 8,
                prepaidBalance: 2666.67,
                extraCredits: 2,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "residential",
                loyaltyPoints: 850,
                avgRating: 4.8,
                emergencyContact: "Marie Tremblay - 819-555-0124",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: false,
                    preferredDay: "tuesday",
                    preferredTime: "morning"
                }
            },
            {
                id: 2,
                name: "Marie Dubois",
                email: "marie@example.com",
                phone: "819-555-0456", 
                address: "456 Avenue des √ârables, Ottawa, ON",
                password: "DR2025!",
                contractAmount: 6000,
                totalVisits: 24,
                usedVisits: 15,
                prepaidBalance: 2250,
                extraCredits: 0,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "premium",
                loyaltyPoints: 1200,
                avgRating: 4.9,
                emergencyContact: "Paul Dubois - 819-555-0457",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: true,
                    preferredDay: "friday",
                    preferredTime: "afternoon"
                }
            },
            {
                id: 3,
                name: "Restaurant Le Gourmet",
                email: "contact@legourmet.ca",
                phone: "819-555-0789",
                address: "789 Boulevard Commercial, Gatineau, QC",
                password: "DR2025!",
                contractAmount: 8000,
                totalVisits: 24,
                usedVisits: 12,
                prepaidBalance: 2666.67,
                extraCredits: 0,
                contractStart: "2025-01-01",
                contractEnd: "2025-12-31",
                createdAt: "2025-01-01",
                clientType: "commercial",
                loyaltyPoints: 400,
                avgRating: 4.7,
                emergencyContact: "Manager - 819-555-0790",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: false,
                    preferredDay: "monday",
                    preferredTime: "morning"
                }
            }
        ];

        let appointments = [
            {
                id: 1,
                userId: 1,
                date: "2025-07-20",
                time: "09:00",
                service: "menage",
                status: "confirmed",
                cost: 166.67,
                notes: "Attention aux plantes",
                createdAt: "2025-07-10",
                technician: "Jean-Marc L.",
                urgency: "normal",
                photoService: false,
                rating: null,
                ratingComment: ""
            },
            {
                id: 2,
                userId: 1,
                date: "2025-07-05",
                time: "14:00",
                service: "vitres",
                status: "completed",
                cost: 166.67,
                notes: "",
                createdAt: "2025-06-25",
                technician: "Sophie D.",
                urgency: "normal",
                photoService: true,
                rating: 5,
                ratingComment: "Excellent travail, tr√®s satisfait!"
            },
            {
                id: 3,
                userId: 2,
                date: "2025-07-18",
                time: "10:00",
                service: "auto-complet",
                status: "pending",
                cost: 250.00,
                notes: "V√©hicule dans l'entr√©e",
                createdAt: "2025-07-11",
                technician: "Michel R.",
                urgency: "normal",
                photoService: false,
                rating: null,
                ratingComment: ""
            },
            {
                id: 4,
                userId: 3,
                date: "2025-07-15",
                time: "07:00",
                service: "menage",
                status: "completed",
                cost: 333.33,
                notes: "Nettoyage cuisine commercial",
                createdAt: "2025-07-08",
                technician: "Jean-Marc L.",
                urgency: "normal",
                photoService: true,
                rating: 4,
                ratingComment: "Bon service"
            }
        ];

        let technicians = [
            {
                id: 1,
                name: "Jean-Marc L.",
                email: "jm.laurent@docshine.net",
                phone: "819-555-0100",
                specialty: "all",
                monthlyServices: 45,
                avgRating: 4.9,
                status: "active"
            },
            {
                id: 2,
                name: "Sophie D.",
                email: "s.dubois@docshine.net",
                phone: "819-555-0101",
                specialty: "residential",
                monthlyServices: 38,
                avgRating: 4.8,
                status: "active"
            },
            {
                id: 3,
                name: "Michel R.",
                email: "m.roy@docshine.net",
                phone: "819-555-0102",
                specialty: "commercial",
                monthlyServices: 52,
                avgRating: 4.7,
                status: "active"
            }
        ];

        let communications = [];
        let currentUser = null;
        let currentRole = null;
        let lastRating = 0;

        const adminCredentials = {
            email: "admin@docshine.net",
            password: "DrShine2025!"
        };

        const serviceNames = {
            'menage': 'Entretien m√©nager',
            'vitres': 'Lavage de vitres', 
            'auto-ext': 'Lavage auto ext√©rieur',
            'auto-int': 'Lavage auto int√©rieur',
            'auto-complet': 'Lavage auto complet',
            'bacs': 'Lavage bacs √† ordures',
            'goutieres': 'Nettoyage goutti√®res',
            'sinistre': 'Nettoyage apr√®s sinistre'
        };

        // Fonctions utilitaires
        function calculateCostPerVisit(user) {
            return user.contractAmount / user.totalVisits;
        }

        function generatePassword() {
            return "DR" + new Date().getFullYear() + "!";
        }

        function getCurrentURL() {
            return window.location.href;
        }

        function showNotification(message, type = 'info') {
            const bar = document.getElementById('notificationBar');
            bar.textContent = message;
            bar.className = `notification-bar alert-${type}`;
            bar.classList.remove('hidden');
            
            setTimeout(() => {
                bar.classList.add('hidden');
            }, 5000);
        }

        // Gestion des r√¥les
        function selectRole(role) {
            document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
            event.target.classList.add('active');
            
            document.getElementById('roleSelection').classList.add('hidden');
            
            if (role === 'client') {
                currentRole = 'client';
                document.getElementById('clientInterface').classList.remove('hidden');
            } else {
                currentRole = 'admin';
                document.getElementById('adminInterface').classList.remove('hidden');
            }
        }

        // Connexion client
        document.getElementById('clientLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('clientEmail').value;
            const password = document.getElementById('clientPassword').value;

            const user = users.find(u => u.email === email && u.password === password);
            
            if (user) {
                currentUser = user;
                showClientDashboard();
                showNotification(`Bienvenue ${user.name} ! üéâ`, 'success');
            } else {
                showError('clientLoginError', 'Email ou mot de passe incorrect');
            }
        });

        // Connexion admin
        document.getElementById('adminLoginForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const email = document.getElementById('adminEmail').value;
            const password = document.getElementById('adminPassword').value;

            if (email === adminCredentials.email && password === adminCredentials.password) {
                showAdminPanel();
                showNotification('Acc√®s administrateur autoris√© üîê', 'success');
            } else {
                showError('adminLoginError', 'Identifiants administrateur incorrects');
            }
        });

        function showClientDashboard() {
            document.getElementById('clientAuth').classList.add('hidden');
            document.getElementById('clientDashboard').classList.remove('hidden');
            
            updateClientDashboard();
            updateClientBookingDate();
            updateLoyaltyProgram();
            loadClientUpcomingAppointments();
        }

        function showAdminPanel() {
            document.getElementById('adminAuth').classList.add('hidden');
            document.getElementById('adminPanel').classList.remove('hidden');
            
            updateAdminInterface();
        }

        function updateClientDashboard() {
            document.getElementById('clientWelcome').textContent = `Bienvenue, ${currentUser.name}`;
            document.getElementById('clientInfo').textContent = 
                `Contrat ${currentUser.clientType}: ${currentUser.contractAmount}$ (${currentUser.totalVisits} passages)`;
            
            const costPerVisit = calculateCostPerVisit(currentUser);
            const remaining = currentUser.totalVisits - currentUser.usedVisits;
            
            // Stats rapides
            document.getElementById('clientPassagesLeft').textContent = remaining;
            document.getElementById('clientBalanceAmount').textContent = `${currentUser.prepaidBalance.toFixed(0)}$`;
            document.getElementById('clientSatisfactionScore').textContent = `${currentUser.avgRating}‚≠ê`;
            
            // Prochain service
            const nextAppt = appointments
                .filter(apt => apt.userId === currentUser.id && new Date(apt.date) >= new Date())
                .sort((a, b) => new Date(a.date) - new Date(b.date))[0];
                
            if (nextAppt) {
                const daysUntil = Math.ceil((new Date(nextAppt.date) - new Date()) / (1000 * 60 * 60 * 24));
                document.getElementById('clientNextService').textContent = `${daysUntil}j`;
            } else {
                document.getElementById('clientNextService').textContent = '--';
            }

            loadClientDetailedHistory();
            populateClientProfile();
        }

        function updateLoyaltyProgram() {
            document.getElementById('loyaltyPoints').textContent = currentUser.loyaltyPoints;
            
            // Animation du cercle de progression
            const progress = (currentUser.loyaltyPoints % 1000) / 1000;
            const circumference = 2 * Math.PI * 50;
            const offset = circumference - (progress * circumference);
            
            document.getElementById('loyaltyProgress').style.strokeDashoffset = offset;
        }

        function loadClientUpcomingAppointments() {
            const upcoming = appointments
                .filter(apt => apt.userId === currentUser.id && new Date(apt.date) >= new Date())
                .sort((a, b) => new Date(a.date) - new Date(b.date))
                .slice(0, 3);
            
            const container = document.getElementById('clientUpcomingAppts');
            
            if (upcoming.length === 0) {
                container.innerHTML = '<p style="text-align: center; color: #666;">Aucun rendez-vous √† venir. R√©servez d√®s maintenant !</p>';
                return;
            }

            container.innerHTML = upcoming.map(apt => `
                <div class="appointment-card">
                    <div>
                        <strong>${new Date(apt.date).toLocaleDateString('fr-FR')}</strong> √† ${apt.time}<br>
                        <span>${serviceNames[apt.service]}</span><br>
                        <small>Technicien: ${apt.technician}</small>
                    </div>
                    <span class="status-chip status-${apt.status}">
                        ${apt.status === 'confirmed' ? 'Confirm√©' : 'En attente'}
                    </span>
                </div>
            `).join('');
        }

        function loadClientDetailedHistory() {
            const userAppointments = appointments
                .filter(apt => apt.userId === currentUser.id)
                .sort((a, b) => new Date(b.date) - new Date(a.date));
            
            const tbody = document.getElementById('clientDetailedHistory');
            
            if (userAppointments.length === 0) {
                tbody.innerHTML = '<tr><td colspan="7" style="text-align: center;">Aucun historique pour le moment</td></tr>';
                return;
            }

            tbody.innerHTML = userAppointments.map(apt => `
                <tr>
                    <td>${new Date(apt.date).toLocaleDateString('fr-FR')}</td>
                    <td>${serviceNames[apt.service]}</td>
                    <td>${apt.technician}</td>
                    <td><span class="status-chip status-${apt.status}">
                        ${apt.status === 'confirmed' ? 'Confirm√©' : apt.status === 'completed' ? 'Termin√©' : 'En attente'}
                    </span></td>
                    <td>${apt.rating ? apt.rating + '‚≠ê' : '--'}</td>
                    <td>${apt.cost.toFixed(2)}$</td>
                    <td>${apt.photoService ? 'üì∏ Oui' : '--'}</td>
                </tr>
            `).join('');
        }

        function populateClientProfile() {
            document.getElementById('profileName').value = currentUser.name;
            document.getElementById('profileEmail').value = currentUser.email;
            document.getElementById('profilePhone').value = currentUser.phone;
            document.getElementById('profileAddress').value = currentUser.address;
            document.getElementById('emergencyContact').value = currentUser.emergencyContact || '';
            
            // Pr√©f√©rences
            document.getElementById('emailNotifications').checked = currentUser.preferences.emailNotifications;
            document.getElementById('smsNotifications').checked = currentUser.preferences.smsNotifications;
            document.getElementById('preferredDay').value = currentUser.preferences.preferredDay;
            document.getElementById('preferredTime').value = currentUser.preferences.preferredTime;
        }

        // Gestion des onglets
        function switchClientTab(tab) {
            document.querySelectorAll('.tabs .tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.dashboard-content .tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
        }

        function switchAdminTab(tab) {
            document.querySelectorAll('.tabs .tab-btn').forEach(btn => btn.classList.remove('active'));
            document.querySelectorAll('.admin-content .tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tab + 'Tab').classList.add('active');
            
            if (tab === 'dashboard') {
                updateAdminDashboard();
            } else if (tab === 'clients') {
                loadFullClientsTable();
            } else if (tab === 'appointments') {
                loadAllAppointments();
                updateClientSelects();
            }
        }

        function updateClientBookingDate() {
            const today = new Date();
            const tomorrow = new Date(today);
            tomorrow.setDate(tomorrow.getDate() + 1);
            
            document.getElementById('clientDate').min = tomorrow.toISOString().split('T')[0];
            document.getElementById('clientDate').value = tomorrow.toISOString().split('T')[0];
        }

        // R√©servation client avec fonctionnalit√©s avanc√©es
        document.getElementById('clientBookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const service = document.getElementById('clientService').value;
            const date = document.getElementById('clientDate').value;
            const time = document.getElementById('clientTime').value;
            const notes = document.getElementById('clientNotes').value;
            const urgency = document.getElementById('urgencyLevel').value;
            const photoService = document.getElementById('photoService').checked;
            
            let costPerVisit = calculateCostPerVisit(currentUser);
            
            // Calcul des frais suppl√©mentaires
            if (urgency === 'urgent') costPerVisit += 15;
            if (urgency === 'emergency') costPerVisit += 35;
            if (photoService) costPerVisit += 5;
            
            if (currentUser.prepaidBalance < costPerVisit && currentUser.extraCredits === 0) {
                showError('clientBookingError', 'Solde insuffisant. Contactez Dr. Shine pour ajouter des fonds.');
                return;
            }

            // V√©rifier disponibilit√©
            const isBooked = appointments.some(apt => 
                apt.date === date && apt.time === time && apt.status !== 'cancelled'
            );

            if (isBooked) {
                showError('clientBookingError', 'Ce cr√©neau est d√©j√† r√©serv√©. Choisissez une autre heure.');
                return;
            }

            // Assigner automatiquement un technicien
            const availableTech = technicians.find(tech => tech.status === 'active');

            const newAppointment = {
                id: appointments.length + 1,
                userId: currentUser.id,
                date: date,
                time: time,
                service: service,
                notes: notes,
                status: 'confirmed',
                cost: costPerVisit,
                createdAt: new Date().toISOString().split('T')[0],
                technician: availableTech ? availableTech.name : "√Ä assigner",
                urgency: urgency,
                photoService: photoService,
                rating: null,
                ratingComment: ""
            };

            appointments.push(newAppointment);
            
;
            document.getElementById('adminTotalClients').textContent = activeClients;
            document.getElementById('adminTodayAppointments').textContent = todayAppointments;
            document.getElementById('adminAvgSatisfaction').textContent = `${avgSatisfaction.toFixed(1)}‚≠ê`;
            document.getElementById('adminLowBalanceClients').textContent = lowBalanceClients;
        }

        function updateAdminDashboard() {
            loadTodayAppointments();
            updateTargetCounts();
        }

        function loadTodayAppointments() {
            const today = new Date().toISOString().split('T')[0];
            const todayAppts = appointments
                .filter(apt => apt.date === today)
                .sort((a, b) => a.time.localeCompare(b.time));
            
            const tbody = document.getElementById('todayAppointmentsTable');
            
            if (todayAppts.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center;">Aucun rendez-vous aujourd\'hui</td></tr>';
                return;
            }

            tbody.innerHTML = todayAppts.map(apt => {
                const user = users.find(u => u.id === apt.userId);
                return `
                    <tr>
                        <td>${apt.time}</td>
                        <td>${user ? user.name : 'Inconnu'}</td>
                        <td>${serviceNames[apt.service]}</td>
                        <td>${apt.technician}</td>
                        <td><span class="status-chip status-${apt.status}">
                            ${apt.status === 'confirmed' ? 'Confirm√©' : apt.status === 'completed' ? 'Termin√©' : 'En attente'}
                        </span></td>
                        <td>
                            <button onclick="markCompleted(${apt.id})" class="btn-success" style="font-size: 0.8rem; padding: 5px 10px;">‚úÖ Termin√©</button>
                        </td>
                    </tr>
                `;
            }).join('');
            
            document.getElementById('todayTotal').textContent = todayAppts.length;
            document.getElementById('todayCompleted').textContent = todayAppts.filter(apt => apt.status === 'completed').length;
        }

        function loadFullClientsTable() {
            const tbody = document.getElementById('fullClientsTable');
            
            tbody.innerHTML = users.map(user => {
                const costPerVisit = calculateCostPerVisit(user);
                const remaining = user.totalVisits - user.usedVisits;
                
                return `
                    <tr>
                        <td>
                            <strong>${user.name}</strong><br>
                            <small>${user.clientType}</small>
                        </td>
                        <td>
                            ${user.email}<br>
                            <small>${user.phone}</small>
                        </td>
                        <td>
                            <span class="status-chip status-${user.clientType === 'premium' ? 'confirmed' : 'pending'}">
                                ${user.clientType}
                            </span>
                        </td>
                        <td>${user.contractAmount}$</td>
                        <td>${user.usedVisits}/${user.totalVisits} (${remaining} restants)</td>
                        <td>
                            <span style="color: ${user.prepaidBalance < 200 ? 'red' : 'green'}">
                                ${user.prepaidBalance.toFixed(2)}$
                            </span>
                        </td>
                        <td>${user.avgRating ? user.avgRating.toFixed(1) + '‚≠ê' : '--'}</td>
                        <td>
                            <button onclick="editClientDetails(${user.id})" class="btn-warning" style="font-size: 0.8rem; padding: 5px 10px; margin: 2px;">‚úèÔ∏è Modifier</button>
                            <button onclick="sendClientEmail(${user.id})" class="btn-info" style="font-size: 0.8rem; padding: 5px 10px; margin: 2px;">üìß Email</button>
                        </td>
                    </tr>
                `;
            }).join('');
        }

        function loadAllAppointments() {
            const tbody = document.getElementById('allAppointmentsTable');
            
            const allAppointments = appointments
                .sort((a, b) => new Date(b.date) - new Date(a.date))
                .map(apt => {
                    const user = users.find(u => u.id === apt.userId);
                    return { ...apt, userName: user ? user.name : 'Inconnu' };
                });
            
            tbody.innerHTML = allAppointments.map(apt => `
                <tr>
                    <td>${new Date(apt.date).toLocaleDateString('fr-FR')}</td>
                    <td>${apt.time}</td>
                    <td>${apt.userName}</td>
                    <td>
                        ${serviceNames[apt.service]}
                        ${apt.urgency !== 'normal' ? `<br><small style="color: orange;">‚ö° ${apt.urgency}</small>` : ''}
                        ${apt.photoService ? '<br><small style="color: blue;">üì∏ Photos</small>' : ''}
                    </td>
                    <td>${apt.technician}</td>
                    <td><span class="status-chip status-${apt.status}">
                        ${apt.status === 'confirmed' ? 'Confirm√©' : apt.status === 'completed' ? 'Termin√©' : 'En attente'}
                    </span></td>
                    <td>
                        <button onclick="markCompleted(${apt.id})" class="btn-success" style="font-size: 0.8rem; padding: 5px 10px; margin: 2px;">‚úÖ</button>
                        <button onclick="viewAppointmentDetails(${apt.id})" class="btn-info" style="font-size: 0.8rem; padding: 5px 10px; margin: 2px;">üëÅÔ∏è</button>
                    </td>
                </tr>
            `).join('');
        }

        function updateClientSelects() {
            const selects = ['adminClientSelect', 'emailClientSelect'];
            
            selects.forEach(selectId => {
                const select = document.getElementById(selectId);
                if (select) {
                    select.innerHTML = '<option value="">-- Choisir un client --</option>' +
                        users.map(user => `<option value="${user.id}">${user.name} (${user.email})</option>`).join('');
                }
            });
        }

        function updateTargetCounts() {
            const target = document.getElementById('emailTarget');
            if (target) {
                const value = target.value;
                let count = 0;
                
                switch(value) {
                    case 'all':
                        count = users.length;
                        break;
                    case 'residential':
                        count = users.filter(u => u.clientType === 'residential').length;
                        break;
                    case 'commercial':
                        count = users.filter(u => u.clientType === 'commercial').length;
                        break;
                    case 'low_balance':
                        count = users.filter(u => u.prepaidBalance < 200).length;
                        break;
                    case 'inactive':
                        const thirtyDaysAgo = new Date();
                        thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                        count = users.filter(u => {
                            const lastAppt = appointments
                                .filter(apt => apt.userId === u.id)
                                .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                            return !lastAppt || new Date(lastAppt.date) < thirtyDaysAgo;
                        }).length;
                        break;
                    default:
                        count = users.length;
                }
                
                const targetSpan = document.getElementById('targetCount');
                if (targetSpan) {
                    targetSpan.textContent = count;
                }
            }
        }

        // Nouveau client
        document.getElementById('newClientForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const name = document.getElementById('newClientName').value;
            const email = document.getElementById('newClientEmail').value;
            const phone = document.getElementById('newClientPhone').value;
            const address = document.getElementById('newClientAddress').value;
            const contractAmount = parseFloat(document.getElementById('contractAmount').value);
            const totalVisits = parseInt(document.getElementById('totalVisits').value);
            const initialPayment = parseFloat(document.getElementById('initialPayment').value);
            const clientType = document.getElementById('clientType').value;

            if (users.find(user => user.email === email)) {
                showError('newClientSuccess', 'Cet email est d√©j√† utilis√©');
                return;
            }

            const password = generatePassword();

            const newUser = {
                id: users.length + 1,
                name,
                email,
                phone,
                address,
                password,
                contractAmount,
                totalVisits,
                usedVisits: 0,
                prepaidBalance: initialPayment,
                extraCredits: 0,
                contractStart: new Date().toISOString().split('T')[0],
                contractEnd: new Date(new Date().setFullYear(new Date().getFullYear() + 1)).toISOString().split('T')[0],
                createdAt: new Date().toISOString().split('T')[0],
                clientType,
                loyaltyPoints: 0,
                avgRating: 0,
                emergencyContact: "",
                preferences: {
                    emailNotifications: true,
                    smsNotifications: false,
                    preferredDay: "",
                    preferredTime: ""
                }
            };

            users.push(newUser);
            
            // Envoyer email d'identifiants
            sendCredentialsEmail(newUser, password);
            
            showSuccess('newClientSuccess', 'Client cr√©√© avec succ√®s! Email d\'identifiants envoy√©.');
            document.getElementById('newClientForm').reset();
            
            updateAdminInterface();
            
            setTimeout(() => {
                document.getElementById('newClientSuccess').classList.add('hidden');
            }, 5000);
        });

        // Recherche clients
        function searchClients() {
            const query = document.getElementById('clientSearch').value.toLowerCase();
            const results = users.filter(user => 
                user.name.toLowerCase().includes(query) ||
                user.email.toLowerCase().includes(query) ||
                user.phone.includes(query)
            );
            
            const container = document.getElementById('searchResults');
            
            if (query.length < 2) {
                container.innerHTML = '';
                return;
            }
            
            if (results.length === 0) {
                container.innerHTML = '<p>Aucun client trouv√©</p>';
                return;
            }
            
            container.innerHTML = results.map(user => `
                <div class="appointment-card" onclick="editClientDetails(${user.id})">
                    <div>
                        <strong>${user.name}</strong><br>
                        <small>${user.email} - ${user.phone}</small>
                    </div>
                    <span class="status-chip status-confirmed">${user.clientType}</span>
                </div>
            `).join('');
        }

        // Booking admin
        document.getElementById('adminBookingForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const clientId = parseInt(document.getElementById('adminClientSelect').value);
            const service = document.getElementById('adminService').value;
            const date = document.getElementById('adminDate').value;
            const time = document.getElementById('adminTime').value;
            const technician = document.getElementById('assignedTechnician').value;
            const notes = document.getElementById('adminNotes').value;
            
            const user = users.find(u => u.id === clientId);
            if (!user) return;
            
            const costPerVisit = calculateCostPerVisit(user);
            
            const newAppointment = {
                id: appointments.length + 1,
                userId: clientId,
                date: date,
                time: time,
                service: service,
                notes: notes,
                status: 'confirmed',
                cost: costPerVisit,
                createdAt: new Date().toISOString().split('T')[0],
                technician: technician || "√Ä assigner",
                urgency: "normal",
                photoService: false,
                rating: null,
                ratingComment: ""
            };

            appointments.push(newAppointment);
            
            // D√©duire du solde
            user.usedVisits++;
            user.prepaidBalance -= costPerVisit;
            
            // Envoyer notifications
            sendAppointmentConfirmationEmails(newAppointment);
            
            showSuccess('adminBookingSuccess', 'Rendez-vous cr√©√© avec succ√®s!');
            document.getElementById('adminBookingForm').reset();
            
            updateAdminInterface();
            
            setTimeout(() => {
                document.getElementById('adminBookingSuccess').classList.add('hidden');
            }, 3000);
        });

        // Fonctions utilitaires admin
        function markCompleted(appointmentId) {
            const appointment = appointments.find(apt => apt.id === appointmentId);
            if (appointment) {
                appointment.status = 'completed';
                
                // Ajouter points de fid√©lit√© au client
                const user = users.find(u => u.id === appointment.userId);
                if (user) {
                    user.loyaltyPoints += 10;
                }
                
                sendServiceCompletionEmail(appointment);
                updateAdminInterface();
                showNotification('Service marqu√© comme termin√©! üìã', 'success');
            }
        }

        function editClientDetails(clientId) {
            const user = users.find(u => u.id === clientId);
            if (!user) return;
            
            const newAmount = prompt(`Nouveau montant de contrat pour ${user.name} :`, user.contractAmount);
            if (newAmount && !isNaN(newAmount)) {
                user.contractAmount = parseFloat(newAmount);
                updateAdminInterface();
                showNotification(`Contrat de ${user.name} mis √† jour!`, 'success');
            }
        }

        function sendClientEmail(clientId) {
            const user = users.find(u => u.id === clientId);
            if (!user) return;
            
            const subject = prompt('Objet de l\'email :');
            const message = prompt('Message :');
            
            if (subject && message) {
                sendCustomEmail(user, subject, message);
                showNotification(`Email envoy√© √† ${user.name}!`, 'success');
            }
        }

        function viewAppointmentDetails(appointmentId) {
            const appointment = appointments.find(apt => apt.id === appointmentId);
            const user = users.find(u => u.id === appointment.userId);
            
            alert(`
D√©tails du rendez-vous:

Client: ${user.name}
Service: ${serviceNames[appointment.service]}
Date: ${new Date(appointment.date).toLocaleDateString('fr-FR')}
Heure: ${appointment.time}
Technicien: ${appointment.technician}
Co√ªt: ${appointment.cost.toFixed(2)}$
Statut: ${appointment.status}
${appointment.notes ? 'Notes: ' + appointment.notes : ''}
${appointment.rating ? 'Note client: ' + appointment.rating + '‚≠ê' : ''}
            `);
        }

        // Syst√®me d'emails avanc√©
        function sendAppointmentConfirmationEmails(appointment) {
            const user = users.find(u => u.id === appointment.userId);
            
            // Email au client
            const clientEmailContent = generateAppointmentConfirmationEmail(appointment, user, 'client');
            simulateEmailSend('Confirmation de rendez-vous - Dr. Shine', clientEmailContent, user.email);
            
            // Email √† l'entreprise
            const adminEmailContent = generateAppointmentConfirmationEmail(appointment, user, 'admin');
            simulateEmailSend('Nouveau rendez-vous confirm√©', adminEmailContent, 'francoisfreddyateba2@gmail.com');
        }

        function sendCredentialsEmail(user, password) {
            const emailContent = generateCredentialsEmail(user.email, password, getCurrentURL());
            simulateEmailSend('Bienvenue chez Dr. Shine - Vos identifiants', emailContent, user.email);
        }

        function sendServiceCompletionEmail(appointment) {
            const user = users.find(u => u.id === appointment.userId);
            const emailContent = generateServiceCompletionEmail(appointment, user);
            simulateEmailSend('Service termin√© - Dr. Shine', emailContent, 'francoisfreddyateba2@gmail.com');
        }

        function sendRatingNotification(appointment, rating, comment) {
            const user = users.find(u => u.id === appointment.userId);
            const emailContent = `
NOUVELLE √âVALUATION CLIENT

Client: ${user.name}
Service: ${serviceNames[appointment.service]}
Date: ${new Date(appointment.date).toLocaleDateString('fr-FR')}
Technicien: ${appointment.technician}

Note: ${rating}‚≠ê
${comment ? 'Commentaire: ' + comment : 'Aucun commentaire'}

${rating >= 4 ? '‚úÖ Excellente √©valuation!' : rating >= 3 ? '‚ö†Ô∏è √âvaluation correcte' : '‚ùå Attention - √âvaluation faible'}
            `;
            
            simulateEmailSend('Nouvelle √©valuation client', emailContent, 'francoisfreddyateba2@gmail.com');
        }

        function sendCustomEmail(user, subject, message) {
            const emailContent = generateCustomEmail(message, user);
            simulateEmailSend(subject, emailContent, user.email);
            
            // Ajouter √† l'historique
            communications.push({
                id: communications.length + 1,
                date: new Date().toLocaleString('fr-FR'),
                type: 'email',
                recipient: user.email,
                subject: subject,
                content: message
            });
            
            loadCommunicationsHistory();
        }

        // Email de masse
        document.getElementById('massEmailForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const target = document.getElementById('emailTarget').value;
            const subject = document.getElementById('massSubject').value;
            const message = document.getElementById('massMessage').value;
            const includePromo = document.getElementById('includePromo').checked;
            
            let recipients = [];
            
            switch(target) {
                case 'all':
                    recipients = users;
                    break;
                case 'residential':
                    recipients = users.filter(u => u.clientType === 'residential');
                    break;
                case 'commercial':
                    recipients = users.filter(u => u.clientType === 'commercial');
                    break;
                case 'low_balance':
                    recipients = users.filter(u => u.prepaidBalance < 200);
                    break;
                case 'inactive':
                    const thirtyDaysAgo = new Date();
                    thirtyDaysAgo.setDate(thirtyDaysAgo.getDate() - 30);
                    recipients = users.filter(u => {
                        const lastAppt = appointments
                            .filter(apt => apt.userId === u.id)
                            .sort((a, b) => new Date(b.date) - new Date(a.date))[0];
                        return !lastAppt || new Date(lastAppt.date) < thirtyDaysAgo;
                    });
                    break;
            }
            
            let finalMessage = message;
            if (includePromo) {
                finalMessage += '\n\nüéâ OFFRE SP√âCIALE: 10% de r√©duction sur votre prochain service! Code: SHINE10';
            }
            
            recipients.forEach(user => {
                sendCustomEmail(user, subject, finalMessage);
            });
            
            showSuccess('massEmailSuccess', `Email envoy√© √† ${recipients.length} clients!`);
            document.getElementById('massEmailForm').reset();
            
            setTimeout(() => {
                document.getElementById('massEmailSuccess').classList.add('hidden');
            }, 5000);
        });

        // Notifications push
        function sendPushNotification() {
            const message = document.getElementById('pushMessage').value;
            const type = document.getElementById('pushType').value;
            
            if (!message) return;
            
            // Simulation notification push
            showNotification(`üì± Notification ${type}: ${message}`, 'info');
            
            communications.push({
                id: communications.length + 1,
                date: new Date().toLocaleString('fr-FR'),
                type: 'push',
                recipient: 'Tous les clients',
                subject: `Notification ${type}`,
                content: message
            });
            
            showSuccess('pushSuccess', 'Notification push envoy√©e!');
            document.getElementById('pushMessage').value = '';
            loadCommunicationsHistory();
            
            setTimeout(() => {
                document.getElementById('pushSuccess').classList.add('hidden');
            }, 3000);
        }

        function loadCommunicationsHistory() {
            const container = document.getElementById('communicationsHistory');
            
            if (communications.length === 0) {
                container.innerHTML = '<div style="text-align: center; color: #666;">Aucune communication pour le moment...</div>';
                return;
            }
            
            container.innerHTML = communications
                .slice(-10)
                .reverse()
                .map(comm => `
                    <div class="appointment-card">
                        <div>
                            <strong>${comm.type === 'email' ? 'üìß' : 'üì±'} ${comm.subject}</strong><br>
                            <small>√Ä: ${comm.recipient} - ${comm.date}</small>
                        </div>
                        <span class="status-chip status-completed">Envoy√©</span>
                    </div>
                `).join('');
        }

        // Chat en direct
        function toggleChat() {
            const widget = document.getElementById('chatWidget');
            const toggle = document.querySelector('.chat-toggle');
            
            if (widget.style.display === 'none' || !widget.style.display) {
                widget.style.display = 'block';
                toggle.style.display = 'none';
            } else {
                widget.style.display = 'none';
                toggle.style.display = 'block';
            }
        }

        function openChat() {
            toggleChat();
        }

        function handleChatEnter(event) {
            if (event.key === 'Enter') {
                sendChatMessage();
            }
        }

        function sendChatMessage() {
            const input = document.getElementById('chatInput');
            const messages = document.getElementById('chatMessages');
            const message = input.value.trim();
            
            if (!message) return;
            
            // Ajouter message client
            messages.innerHTML += `
                <div style="text-align: right; margin: 10px 0;">
                    <div style="background: var(--primary-blue); color: white; padding: 10px; border-radius: 10px; display: inline-block; max-width: 80%;">
                        ${message}
                    </div>
                </div>
            `;
            
            input.value = '';
            
            // R√©ponse automatique apr√®s 1 seconde
            setTimeout(() => {
                const response = generateChatResponse(message);
                messages.innerHTML += `
                    <div style="margin: 10px 0;">
                        <div style="background: #f0f4ff; padding: 10px; border-radius: 10px; display: inline-block; max-width: 80%;">
                            <strong>Dr. Shine Support :</strong><br>
                            ${response}
                        </div>
                    </div>
                `;
                messages.scrollTop = messages.scrollHeight;
            }, 1000);
            
            messages.scrollTop = messages.scrollHeight;
        }

        function generateChatResponse(message) {
            const msg = message.toLowerCase();
            
            if (msg.includes('rdv') || msg.includes('rendez-vous') || msg.includes('r√©server')) {
                return 'Pour r√©server un rendez-vous, utilisez l\'onglet "R√©server" dans votre espace client. Nous avons des cr√©neaux disponibles d√®s demain! üìÖ';
            } else if (msg.includes('solde') || msg.includes('paiement') || msg.includes('facture')) {
                return 'Votre solde est visible dans votre tableau de bord. Pour tout ajustement, contactez-nous au 819-918-5041. üí∞';
            } else if (msg.includes('technicien') || msg.includes('√©quipe')) {
                return 'Notre √©quipe de techniciens exp√©riment√©s vous garantit un service de qualit√© sup√©rieure! Chaque intervention est suivie et √©valu√©e. üë∑‚Äç‚ôÇÔ∏è';
            } else if (msg.includes('urgence') || msg.includes('urgent')) {
                return 'Pour les urgences, appelez directement au 819-918-5041. Nous avons un service 24h/24 et 7j/7! üö®';
            } else if (msg.includes('merci') || msg.includes('super') || msg.includes('parfait')) {
                return 'Merci beaucoup! Votre satisfaction est notre priorit√©. N\'h√©sitez pas si vous avez d\'autres questions! üòä';
            } else {
                return 'Je transmets votre message √† notre √©quipe. Pour une r√©ponse rapide, appelez le 819-918-5041 ou envoyez un email √† info@docshine.net. üìû';
            }
        }

        // Modals
        function openQuickClientModal() {
            document.getElementById('quickClientModal').style.display = 'block';
        }

        function closeModal(modalId) {
            document.getElementById(modalId).style.display = 'none';
        }

        function openCalendarView() {
            alert('Vue calendrier - Fonctionnalit√© en d√©veloppement\n\nPour une vue calendrier compl√®te, int√©grez avec Google Calendar ou un syst√®me de planning avanc√©.');
        }

        // Actions rapides admin
        function sendMassEmail() {
            document.querySelector('[onclick="switchAdminTab(\'communications\')"]').click();
            showNotification('Passez √† l\'onglet Communications pour l\'email de masse', 'info');
        }

        function generateReport() {
            const totalRevenue = users.reduce((sum, user) => sum + (user.contractAmount - user.prepaidBalance), 0);
            const totalServices = appointments.filter(apt => apt.status === 'completed').length;
            const avgSatisfaction = users.reduce((sum, user) => sum + user.avgRating, 0) / users.length;
            
            const report = `
üìä RAPPORT MENSUEL DR. SHINE

üí∞ Chiffre d'affaires: ${totalRevenue.toFixed(2)}$
üîß Services effectu√©s: ${totalServices}
üë• Clients actifs: ${users.length}
‚≠ê Satisfaction moyenne: ${avgSatisfaction.toFixed(1)}/5

üèÜ Top Technicien: Jean-Marc L. (4.9‚≠ê)
üìà Croissance: +15% vs mois dernier
üéØ Objectif mensuel: 85% atteint

G√©n√©r√© le ${new Date().toLocaleDateString('fr-FR')}
            `;
            
            alert(report);
            
            // Envoyer par email
            simulateEmailSend('Rapport mensuel Dr. Shine', report, 'francoisfreddyateba2@gmail.com');
            showNotification('Rapport g√©n√©r√© et envoy√© par email!', 'success');
        }

        function backupData() {
            const backup = {
                users: users,
                appointments: appointments,
                communications: communications,
                backupDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(backup, null, 2);
            const dataBlob = new Blob([dataStr], {type: 'application/json'});
            
            const link = document.createElement('a');
            link.href = URL.createObjectURL(dataBlob);
            link.download = `drshine_backup_${new Date().toISOString().split('T')[0]}.json`;
            link.click();
            
            showNotification('Sauvegarde t√©l√©charg√©e avec succ√®s!', 'success');
        }

        // Fermeture des alertes
        function closeAlert(alertElement) {
            alertElement.parentElement.style.display = 'none';
        }

        // Templates d'emails
        function generateCredentialsEmail(email, password, link) {
            return `
Bonjour et bienvenue chez Dr. Shine! üåü

Nous sommes ravis de vous compter parmi nos clients privil√©gi√©s.

üîó Votre espace client : ${link}
üìß Email : ${email}
üîë Mot de passe : ${password}

Dans votre espace personnel, vous pourrez :
‚úÖ Consulter votre contrat et solde en temps r√©el
‚úÖ R√©server vos rendez-vous facilement
‚úÖ Suivre l'historique de vos services
‚úÖ √âvaluer nos prestations
‚úÖ Accumuler des points de fid√©lit√©
‚úÖ Contacter notre support en direct

Notre √©quipe d'experts est √† votre service pour redonner √©clat et propret√© √† votre environnement.

üìû Support : +1 819-918-5041
üìß Email : info@docshine.net
üåê Site web : www.docshine.net

Merci de votre confiance !
L'√©quipe Dr. Shine ‚ú®
            `.trim();
        }

        function generateAppointmentConfirmationEmail(appointment, user, type) {
            const serviceName = serviceNames[appointment.service];
            const dateStr = new Date(appointment.date).toLocaleDateString('fr-FR');
            
            if (type === 'client') {
                return `
Bonjour ${user.name},

Votre rendez-vous Dr. Shine est confirm√© ! üéâ

üìÖ Date : ${dateStr}
üïê Heure : ${appointment.time}
üßπ Service : ${serviceName}
üë∑ Technicien : ${appointment.technician}
üí∞ Co√ªt : ${appointment.cost.toFixed(2)}$
üìç Adresse : ${user.address}

${appointment.urgency !== 'normal' ? `‚ö° Service ${appointment.urgency}` : ''}
${appointment.photoService ? 'üì∏ Photos avant/apr√®s incluses' : ''}
${appointment.notes ? `üìù Instructions : ${appointment.notes}` : ''}

Notre √©quipe sera ponctuelle et professionnelle. Vous recevrez un rappel 24h avant votre rendez-vous.

üèÜ Points de fid√©lit√© : +10 points apr√®s le service
‚≠ê N'oubliez pas d'√©valuer notre prestation pour gagner 5 points bonus !

üìû Besoin de modifier ? Appelez le 819-918-5041
üí¨ Chat en direct disponible dans votre espace client

Cordialement,
L'√©quipe Dr. Shine ‚ú®
                `.trim();
            } else {
                return `
üîî NOUVEAU RENDEZ-VOUS CONFIRM√â

Client : ${user.name} (${user.clientType})
Email : ${user.email}
T√©l√©phone : ${user.phone}
Adresse : ${user.address}

üìÖ Date : ${dateStr}
üïê Heure : ${appointment.time}
üßπ Service : ${serviceName}
üë∑ Technicien assign√© : ${appointment.technician}
üí∞ Co√ªt : ${appointment.cost.toFixed(2)}$

${appointment.urgency !== 'normal' ? `‚ö° URGENCE: ${appointment.urgency}` : ''}
${appointment.photoService ? 'üì∏ Photos avant/apr√®s demand√©es' : ''}
${appointment.notes ? `üìù Instructions client : ${appointment.notes}` : 'Aucune instruction sp√©ciale'}

üí≥ Solde client restant : ${user.prepaidBalance.toFixed(2)}$
üèÜ Points fid√©lit√© client : ${user.loyaltyPoints}
‚≠ê Note moyenne client : ${user.avgRating}/5

${user.preferences.smsNotifications ? 'üì± Client souhaite rappels SMS' : 'üìß Client pr√©f√®re emails uniquement'}
                `.trim();
            }
        }

        function generateServiceCompletionEmail(appointment, user) {
            const serviceName = serviceNames[appointment.service];
            const dateStr = new Date(appointment.date).toLocaleDateString('fr-FR');
            
            return `
‚úÖ SERVICE TERMIN√â - Dr. Shine

Client : ${user.name}
Service : ${serviceName}
Date : ${dateStr} √† ${appointment.time}
Technicien : ${appointment.technician}
Montant : ${appointment.cost.toFixed(2)}$

üí≥ Nouveau solde client : ${user.prepaidBalance.toFixed(2)}$
üìä Passages restants : ${user.totalVisits - user.usedVisits}
üèÜ Points fid√©lit√© ajout√©s : +10 points
üéØ Total points : ${user.loyaltyPoints}

‚è∞ Statut : Service marqu√© comme termin√© dans le syst√®me
üìß Client peut maintenant √©valuer le service

${user.prepaidBalance < 200 ? '‚ö†Ô∏è ATTENTION: Solde client faible (< 200$)' : ''}
            `.trim();
        }

        function generateCustomEmail(message, user) {
            return `
Bonjour ${user.name},

${message}

Nous restons √† votre disposition pour toute question ou demande particuli√®re.

üìû Support : +1 819-918-5041
üìß Email : info@docshine.net
üí¨ Chat en direct : Via votre espace client

Cordialement,
L'√©quipe Dr. Shine ‚ú®

---
${user.name} | Contrat ${user.clientType} | ${user.prepaidBalance.toFixed(2)}$ de solde
            `.trim();
        }

        function simulateEmailSend(subject, content, recipient) {
            // Simulation console (en production, ici on int√©grerait un vrai service email)
            console.log('üìß EMAIL ENVOY√â:');
            console.log('√Ä:', recipient);
            console.log('Objet:', subject);
            console.log('Contenu:', content);
            console.log('---');
            
            // Ajouter √† l'historique
            communications.push({
                id: communications.length + 1,
                date: new Date().toLocaleString('fr-FR'),
                type: 'email',
                recipient: recipient,
                subject: subject,
                content: content
            });
        }

        function logout() {
            try {
                console.log('D√©connexion...');
                currentUser = null;
                currentRole = null;
                
                // Masquer toutes les interfaces
                const clientInterface = document.getElementById('clientInterface');
                const adminInterface = document.getElementById('adminInterface');
                const clientDashboard = document.getElementById('clientDashboard');
                const adminPanel = document.getElementById('adminPanel');
                const clientAuth = document.getElementById('clientAuth');
                const adminAuth = document.getElementById('adminAuth');
                const roleSelection = document.getElementById('roleSelection');
                
                if (clientInterface) clientInterface.classList.add('hidden');
                if (adminInterface) adminInterface.classList.add('hidden');
                if (clientDashboard) clientDashboard.classList.add('hidden');
                if (adminPanel) adminPanel.classList.add('hidden');
                if (clientAuth) clientAuth.classList.remove('hidden');
                if (adminAuth) adminAuth.classList.remove('hidden');
                
                // R√©afficher la s√©lection de r√¥le
                if (roleSelection) roleSelection.classList.remove('hidden');
                
                // R√©initialiser les boutons de r√¥le
                document.querySelectorAll('.role-btn').forEach(btn => btn.classList.remove('active'));
                
                // Fermer le chat
                const chatWidget = document.getElementById('chatWidget');
                const chatToggle = document.querySelector('.chat-toggle');
                if (chatWidget) chatWidget.style.display = 'none';
                if (chatToggle) chatToggle.style.display = 'block';
                
                // R√©initialiser les formulaires
                const clientLoginForm = document.getElementById('clientLoginForm');
                const adminLoginForm = document.getElementById('adminLoginForm');
                if (clientLoginForm) clientLoginForm.reset();
                if (adminLoginForm) adminLoginForm.reset();
                
                showNotification('D√©connexion r√©ussie. √Ä bient√¥t!');
                console.log('D√©connexion termin√©e');
            } catch (error) {
                console.log('Erreur d√©connexion:', error);
            }
        }

        function showError(elementId, message) {
            try {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = message;
                    element.classList.remove('hidden');
                    
                    setTimeout(() => {
                        element.classList.add('hidden');
                    }, 5000);
                }
            } catch (error) {
                console.log('Erreur affichage erreur:', error);
            }
        }

        function showSuccess(elementId, message) {
            try {
                const element = document.getElementById(elementId);
                if (element) {
                    element.textContent = message;
                    element.classList.remove('hidden');
                }
            } catch (error) {
                console.log('Erreur affichage succ√®s:', error);
            }
        }

        // Initialisation et mise √† jour automatique
        document.addEventListener('DOMContentLoaded', function() {
            console.log('Dr. Shine System Loaded Successfully!');
            
            // Mise √† jour des compteurs emails
            const targetSelect = document.getElementById('emailTarget');
            if (targetSelect) {
                targetSelect.addEventListener('change', updateTargetCounts);
                updateTargetCounts();
            }
            
            // Fermeture modals en cliquant √† l'ext√©rieur
            window.addEventListener('click', function(event) {
                const modals = document.querySelectorAll('.modal');
                modals.forEach(modal => {
                    if (event.target === modal) {
                        modal.style.display = 'none';
                    }
                });
            });
            
            // Mise √† jour m√©t√©o simul√©e
            updateWeatherWidget();
            
            // Notifications automatiques pour admin
            setTimeout(() => {
                if (currentRole === 'admin') {
                    const lowBalanceCount = users.filter(user => user.prepaidBalance < 200).length;
                    if (lowBalanceCount > 0) {
                        showNotification(`‚ö†Ô∏è ${lowBalanceCount} client(s) ont un solde faible`);
                    }
                }
            }, 3000);
        });

        function updateWeatherWidget() {
            try {
                const weather = [
                    "‚òÄÔ∏è Ensoleill√©, 22¬∞C - Parfait pour nos services ext√©rieurs!",
                    "‚õÖ Partiellement nuageux, 18¬∞C - Id√©al pour le nettoyage.",
                    "üåßÔ∏è Pluie l√©g√®re, 15¬∞C - Nos services int√©rieurs sont disponibles!",
                    "‚ùÑÔ∏è Neige, -5¬∞C - Services d'hiver disponibles!"
                ];
                
                const randomWeather = weather[Math.floor(Math.random() * weather.length)];
                const weatherElement = document.getElementById('weatherInfo');
                if (weatherElement) {
                    weatherElement.innerHTML = `<p>${randomWeather}</p>`;
                }
            } catch (error) {
                console.log('Erreur m√©t√©o:', error);
            }
        }

        // Test de diagnostic
        function testSystem() {
            console.log('üîç Test du syst√®me...');
            
            const elements = [
                'roleSelection',
                'clientRoleBtn', 
                'adminRoleBtn',
                'clientInterface',
                'adminInterface'
            ];
            
            elements.forEach(id => {
                const element = document.getElementById(id);
                console.log(`Element ${id}:`, element ? '‚úÖ OK' : '‚ùå MANQUANT');
            });
            
            console.log('Variables:', {
                currentUser: currentUser,
                currentRole: currentRole,
                usersCount: users.length,
                appointmentsCount: appointments.length
            });
        }

        // Mise √† jour automatique toutes les 30 secondes
        setInterval(() => {
            if (currentRole === 'admin') {
                updateAdminStats();
            } else if (currentUser) {
                updateLoyaltyProgram();
            }
        }, 30000);

        // Appel du test apr√®s chargement
        setTimeout(testSystem, 2000);
    </script>
</body>
</html>
